import{g as f,O as m,a as y,C as w}from"./opaque_client.js";const h=f(m.OPAQUE_P256);document.addEventListener("DOMContentLoaded",async()=>{const t=document.getElementById("register-form");t&&t.addEventListener("submit",async a=>{a.preventDefault();const o="Digitopia-opaque-server",n=new FormData(t),e=n.get("username"),c=n.get("password"),i=new y(h),d=await i.registerInit(c),r=await fetch("/api/register/init",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,registrationRequest:d})});if(!r.ok)throw new Error("Registration failed");const{registrationResponse:s}=await r.json(),l={evaluation:new Uint8Array(s.evaluation),server_public_key:new Uint8Array(s.server_public_key)},p=await i.registerFinish(l,e,o),g=new w(e,p.record,e).serialize(),u=btoa(String.fromCharCode(...g));fetch("/api/register/finish",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,credentialFileB64:u})})})});
