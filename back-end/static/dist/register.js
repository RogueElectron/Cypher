import{g as b,O as R,a as y,R as C}from"./opaque_client.js";const f=b(R.OPAQUE_P256);function c(e,t="success"){const s=document.getElementById("alert-container"),r=t==="success"?"alert-success":"alert-danger",o=t==="success"?"bi-check-circle-fill":"bi-exclamation-triangle-fill";s.innerHTML=`
        <div class="alert ${r} alert-dismissible fade show" role="alert">
            <i class="${o} me-2"></i>
            ${e}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    `,t==="success"&&setTimeout(()=>{const i=s.querySelector(".alert");i&&new bootstrap.Alert(i).close()},5e3)}function O(){const e=document.getElementById("alert-container");e.innerHTML=""}function T(e,t){return e!==t?(c("Passwords do not match!","error"),!1):e.length<8?(c("Password must be at least 8 characters long!","error"),!1):!0}document.addEventListener("DOMContentLoaded",async()=>{const e=document.getElementById("register-form");e&&e.addEventListener("submit",async t=>{t.preventDefault(),O();const s=new FormData(e),r=s.get("username"),o=s.get("password"),i=s.get("confirm_password");if(!r||!o||!i){c("Please fill in all fields!","error");return}if(!T(o,i))return;const n=e.querySelector('button[type="submit"]'),g=n.textContent;n.disabled=!0,n.innerHTML='<span class="spinner-border spinner-border-sm me-2" role="status"></span>Registering...';try{const a=new y(f),m=(await a.registerInit(o)).serialize(),l=await fetch("http://localhost:3000/register/init",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:r,registrationRequest:m})});if(!l.ok){const u=await l.json();throw new Error(u.error||"Registration failed")}const{registrationResponse:w}=await l.json(),p=C.deserialize(f,w),h=(await a.registerFinish(p)).record.serialize(),d=await fetch("http://localhost:3000/register/finish",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:r,record:h})});if(!d.ok){const u=await d.json();throw new Error(u.error||"Registration completion failed")}if((await d.json()).success)c(`ðŸŽ‰ Registration successful! Welcome, ${r}! You can now log in with your credentials.`,"success"),e.reset(),setTimeout(()=>{window.location.href="/api/login"},3e3);else throw new Error("Registration failed - please try again")}catch(a){console.error("Registration error:",a),c(`Registration failed: ${a.message}`,"error")}finally{n.disabled=!1,n.textContent=g}})});
