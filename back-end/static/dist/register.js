import{g as m,O as f,a as y}from"./opaque_client.js";const w=m(f.OPAQUE_P256);document.addEventListener("DOMContentLoaded",async()=>{const e=document.getElementById("register-form");e&&e.addEventListener("submit",async a=>{a.preventDefault();const c="Digitopia-opaque-server",r=new FormData(e),t=r.get("username"),d=r.get("password"),n=new y(w),g=await n.registerInit(d),s=await fetch("/api/register/init",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:t,registrationRequest:g})});if(!s.ok)throw new Error("Registration failed");const{registrationResponse:o}=await s.json(),p={evaluation:new Uint8Array(o.evaluation),server_public_key:new Uint8Array(o.server_public_key)},i=(await n.registerFinish(p,t,c)).record;console.log("record",i);const u=i.serialize(),l=btoa(String.fromCharCode(...u));fetch("/api/register/finish",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:t,registrationRecord:l})})})});
