var He=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var mt=He((wt,$)=>{function U(t){let e=0;for(let r=0;r<t.length;r++)e+=t[r].length;const i=new Uint8Array(new ArrayBuffer(e));for(let r=0,n=0;r<t.length;r++)i.set(t[r],n),n+=t[r].length;return i}function Ke(t,e){if(t.length!==e.length||t.length===0)throw new Error("arrays of different length");const i=t.length,r=new Uint8Array(i);for(let n=0;n<i;n++)r[n]=t[n]^e[n];return r}function ce(t){if(!(t>=0&&t<65535))throw new Error("number bigger than 2^16");return new Uint8Array([t>>8&255,t&255])}function Ne(t){switch(t){case"SHA-1":return{outLenBytes:20,blockLenBytes:64};case"SHA-256":return{outLenBytes:32,blockLenBytes:64};case"SHA-384":return{outLenBytes:48,blockLenBytes:128};case"SHA-512":return{outLenBytes:64,blockLenBytes:128};default:throw new Error(`invalid hash name: ${t}`)}}var o={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(t){this.toString=function(){return"CORRUPT: "+this.message},this.message=t},invalid:function(t){this.toString=function(){return"INVALID: "+this.message},this.message=t},bug:function(t){this.toString=function(){return"BUG: "+this.message},this.message=t},notReady:function(t){this.toString=function(){return"NOT READY: "+this.message},this.message=t}}};o.cipher.aes=function(t){this._tables[0][0][0]||this._precompute();var e,i,r,n,s,a=this._tables[0][4],c=this._tables[1],h=t.length,l=1;if(h!==4&&h!==6&&h!==8)throw new o.exception.invalid("invalid aes key size");for(this._key=[n=t.slice(0),s=[]],e=h;e<4*h+28;e++)r=n[e-1],(e%h===0||h===8&&e%h===4)&&(r=a[r>>>24]<<24^a[r>>16&255]<<16^a[r>>8&255]<<8^a[r&255],e%h===0&&(r=r<<8^r>>>24^l<<24,l=l<<1^(l>>7)*283)),n[e]=n[e-h]^r;for(i=0;e;i++,e--)r=n[i&3?e:e-4],e<=4||i<4?s[i]=r:s[i]=c[0][a[r>>>24]]^c[1][a[r>>16&255]]^c[2][a[r>>8&255]]^c[3][a[r&255]]};o.cipher.aes.prototype={encrypt:function(t){return this._crypt(t,0)},decrypt:function(t){return this._crypt(t,1)},_tables:[[[],[],[],[],[]],[[],[],[],[],[]]],_precompute:function(){var t=this._tables[0],e=this._tables[1],i=t[4],r=e[4],n,s,a,c=[],h=[],l,f,u,d,m,y;for(n=0;n<256;n++)h[(c[n]=n<<1^(n>>7)*283)^n]=n;for(s=a=0;!i[s];s^=l||1,a=h[a]||1)for(d=a^a<<1^a<<2^a<<3^a<<4,d=d>>8^d&255^99,i[s]=d,r[d]=s,u=c[f=c[l=c[s]]],y=u*16843009^f*65537^l*257^s*16843008,m=c[d]*257^d*16843008,n=0;n<4;n++)t[n][s]=m=m<<24^m>>>8,e[n][d]=y=y<<24^y>>>8;for(n=0;n<5;n++)t[n]=t[n].slice(0),e[n]=e[n].slice(0)},_crypt:function(t,e){if(t.length!==4)throw new o.exception.invalid("invalid aes block size");var i=this._key[e],r=t[0]^i[0],n=t[e?3:1]^i[1],s=t[2]^i[2],a=t[e?1:3]^i[3],c,h,l,f=i.length/4-2,u,d=4,m=[0,0,0,0],y=this._tables[e],b=y[0],p=y[1],w=y[2],k=y[3],z=y[4];for(u=0;u<f;u++)c=b[r>>>24]^p[n>>16&255]^w[s>>8&255]^k[a&255]^i[d],h=b[n>>>24]^p[s>>16&255]^w[a>>8&255]^k[r&255]^i[d+1],l=b[s>>>24]^p[a>>16&255]^w[r>>8&255]^k[n&255]^i[d+2],a=b[a>>>24]^p[r>>16&255]^w[n>>8&255]^k[s&255]^i[d+3],d+=4,r=c,n=h,s=l;for(u=0;u<4;u++)m[e?3&-u:u]=z[r>>>24]<<24^z[n>>16&255]<<16^z[s>>8&255]<<8^z[a&255]^i[d++],c=r,r=n,n=s,s=a,a=c;return m}};o.bitArray={bitSlice:function(t,e,i){return t=o.bitArray._shiftRight(t.slice(e/32),32-(e&31)).slice(1),i===void 0?t:o.bitArray.clamp(t,i-e)},extract:function(t,e,i){var r,n=Math.floor(-e-i&31);return(e+i-1^e)&-32?r=t[e/32|0]<<32-n^t[e/32+1|0]>>>n:r=t[e/32|0]>>>n,r&(1<<i)-1},concat:function(t,e){if(t.length===0||e.length===0)return t.concat(e);var i=t[t.length-1],r=o.bitArray.getPartial(i);return r===32?t.concat(e):o.bitArray._shiftRight(e,r,i|0,t.slice(0,t.length-1))},bitLength:function(t){var e=t.length,i;return e===0?0:(i=t[e-1],(e-1)*32+o.bitArray.getPartial(i))},clamp:function(t,e){if(t.length*32<e)return t;t=t.slice(0,Math.ceil(e/32));var i=t.length;return e=e&31,i>0&&e&&(t[i-1]=o.bitArray.partial(e,t[i-1]&2147483648>>e-1,1)),t},partial:function(t,e,i){return t===32?e:(i?e|0:e<<32-t)+t*1099511627776},getPartial:function(t){return Math.round(t/1099511627776)||32},equal:function(t,e){if(o.bitArray.bitLength(t)!==o.bitArray.bitLength(e))return!1;var i=0,r;for(r=0;r<t.length;r++)i|=t[r]^e[r];return i===0},_shiftRight:function(t,e,i,r){var n,s=0,a;for(r===void 0&&(r=[]);e>=32;e-=32)r.push(i),i=0;if(e===0)return r.concat(t);for(n=0;n<t.length;n++)r.push(i|t[n]>>>e),i=t[n]<<32-e;return s=t.length?t[t.length-1]:0,a=o.bitArray.getPartial(s),r.push(o.bitArray.partial(e+a&31,e+a>32?i:r.pop(),1)),r},_xor4:function(t,e){return[t[0]^e[0],t[1]^e[1],t[2]^e[2],t[3]^e[3]]},byteswapM:function(t){var e,i,r=65280;for(e=0;e<t.length;++e)i=t[e],t[e]=i>>>24|i>>>8&r|(i&r)<<8|i<<24;return t}};o.codec.utf8String={fromBits:function(t){var e="",i=o.bitArray.bitLength(t),r,n;for(r=0;r<i/8;r++)(r&3)===0&&(n=t[r/4]),e+=String.fromCharCode(n>>>8>>>8>>>8),n<<=8;return decodeURIComponent(escape(e))},toBits:function(t){t=unescape(encodeURIComponent(t));var e=[],i,r=0;for(i=0;i<t.length;i++)r=r<<8|t.charCodeAt(i),(i&3)===3&&(e.push(r),r=0);return i&3&&e.push(o.bitArray.partial(8*(i&3),r)),e}};o.codec.hex={fromBits:function(t){var e="",i;for(i=0;i<t.length;i++)e+=((t[i]|0)+0xf00000000000).toString(16).substr(4);return e.substr(0,o.bitArray.bitLength(t)/4)},toBits:function(t){var e,i=[],r;for(t=t.replace(/\s|0x/g,""),r=t.length,t=t+"00000000",e=0;e<t.length;e+=8)i.push(parseInt(t.substr(e,8),16)^0);return o.bitArray.clamp(i,r*4)}};o.codec.base64={_chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(t,e,i){var r="",n,s=0,a=o.codec.base64._chars,c=0,h=o.bitArray.bitLength(t);for(i&&(a=a.substr(0,62)+"-_"),n=0;r.length*6<h;)r+=a.charAt((c^t[n]>>>s)>>>26),s<6?(c=t[n]<<6-s,s+=26,n++):(c<<=6,s-=6);for(;r.length&3&&!e;)r+="=";return r},toBits:function(t,e){t=t.replace(/\s|=/g,"");var i=[],r,n=0,s=o.codec.base64._chars,a=0,c;for(e&&(s=s.substr(0,62)+"-_"),r=0;r<t.length;r++){if(c=s.indexOf(t.charAt(r)),c<0)throw new o.exception.invalid("this isn't base64!");n>26?(n-=26,i.push(a^c>>>n),a=c<<32-n):(n+=6,a^=c<<32-n)}return n&56&&i.push(o.bitArray.partial(n&56,a,1)),i}};o.codec.base64url={fromBits:function(t){return o.codec.base64.fromBits(t,1,1)},toBits:function(t){return o.codec.base64.toBits(t,1)}};o.codec.bytes={fromBits:function(t){var e=[],i=o.bitArray.bitLength(t),r,n;for(r=0;r<i/8;r++)(r&3)===0&&(n=t[r/4]),e.push(n>>>24),n<<=8;return e},toBits:function(t){var e=[],i,r=0;for(i=0;i<t.length;i++)r=r<<8|t[i],(i&3)===3&&(e.push(r),r=0);return i&3&&e.push(o.bitArray.partial(8*(i&3),r)),e}};o.hash.sha256=function(t){this._key[0]||this._precompute(),t?(this._h=t._h.slice(0),this._buffer=t._buffer.slice(0),this._length=t._length):this.reset()};o.hash.sha256.hash=function(t){return new o.hash.sha256().update(t).finalize()};o.hash.sha256.prototype={blockSize:512,reset:function(){return this._h=this._init.slice(0),this._buffer=[],this._length=0,this},update:function(t){typeof t=="string"&&(t=o.codec.utf8String.toBits(t));var e,i=this._buffer=o.bitArray.concat(this._buffer,t),r=this._length,n=this._length=r+o.bitArray.bitLength(t);if(n>9007199254740991)throw new o.exception.invalid("Cannot hash more than 2^53 - 1 bits");if(typeof Uint32Array<"u"){var s=new Uint32Array(i),a=0;for(e=512+r-(512+r&511);e<=n;e+=512)this._block(s.subarray(16*a,16*(a+1))),a+=1;i.splice(0,16*a)}else for(e=512+r-(512+r&511);e<=n;e+=512)this._block(i.splice(0,16));return this},finalize:function(){var t,e=this._buffer,i=this._h;for(e=o.bitArray.concat(e,[o.bitArray.partial(1,1)]),t=e.length+2;t&15;t++)e.push(0);for(e.push(Math.floor(this._length/4294967296)),e.push(this._length|0);e.length;)this._block(e.splice(0,16));return this.reset(),i},_init:[],_key:[],_precompute:function(){var t=0,e=2,i,r;function n(s){return(s-Math.floor(s))*4294967296|0}for(;t<64;e++){for(r=!0,i=2;i*i<=e;i++)if(e%i===0){r=!1;break}r&&(t<8&&(this._init[t]=n(Math.pow(e,1/2))),this._key[t]=n(Math.pow(e,1/3)),t++)}},_block:function(t){var e,i,r,n,s=this._h,a=this._key,c=s[0],h=s[1],l=s[2],f=s[3],u=s[4],d=s[5],m=s[6],y=s[7];for(e=0;e<64;e++)e<16?i=t[e]:(r=t[e+1&15],n=t[e+14&15],i=t[e&15]=(r>>>7^r>>>18^r>>>3^r<<25^r<<14)+(n>>>17^n>>>19^n>>>10^n<<15^n<<13)+t[e&15]+t[e+9&15]|0),i=i+y+(u>>>6^u>>>11^u>>>25^u<<26^u<<21^u<<7)+(m^u&(d^m))+a[e],y=m,m=d,d=u,u=f+i|0,f=l,l=h,h=c,c=i+(h&l^f&(h^l))+(h>>>2^h>>>13^h>>>22^h<<30^h<<19^h<<10)|0;s[0]=s[0]+c|0,s[1]=s[1]+h|0,s[2]=s[2]+l|0,s[3]=s[3]+f|0,s[4]=s[4]+u|0,s[5]=s[5]+d|0,s[6]=s[6]+m|0,s[7]=s[7]+y|0}};o.mode.ccm={name:"ccm",_progressListeners:[],listenProgress:function(t){o.mode.ccm._progressListeners.push(t)},unListenProgress:function(t){var e=o.mode.ccm._progressListeners.indexOf(t);e>-1&&o.mode.ccm._progressListeners.splice(e,1)},_callProgressListener:function(t){var e=o.mode.ccm._progressListeners.slice(),i;for(i=0;i<e.length;i+=1)e[i](t)},encrypt:function(t,e,i,r,n){var s,a=e.slice(0),c,h=o.bitArray,l=h.bitLength(i)/8,f=h.bitLength(a)/8;if(n=n||64,r=r||[],l<7)throw new o.exception.invalid("ccm: iv must be at least 7 bytes");for(s=2;s<4&&f>>>8*s;s++);return s<15-l&&(s=15-l),i=h.clamp(i,8*(15-s)),c=o.mode.ccm._computeTag(t,e,i,r,n,s),a=o.mode.ccm._ctrMode(t,a,i,c,n,s),h.concat(a.data,a.tag)},decrypt:function(t,e,i,r,n){n=n||64,r=r||[];var s,a=o.bitArray,c=a.bitLength(i)/8,h=a.bitLength(e),l=a.clamp(e,h-n),f=a.bitSlice(e,h-n),u;if(h=(h-n)/8,c<7)throw new o.exception.invalid("ccm: iv must be at least 7 bytes");for(s=2;s<4&&h>>>8*s;s++);if(s<15-c&&(s=15-c),i=a.clamp(i,8*(15-s)),l=o.mode.ccm._ctrMode(t,l,i,f,n,s),u=o.mode.ccm._computeTag(t,l.data,i,r,n,s),!a.equal(l.tag,u))throw new o.exception.corrupt("ccm: tag doesn't match");return l.data},_macAdditionalData:function(t,e,i,r,n,s){var a,c,h,l=[],f=o.bitArray,u=f._xor4;if(a=[f.partial(8,(e.length?64:0)|r-2<<2|s-1)],a=f.concat(a,i),a[3]|=n,a=t.encrypt(a),e.length)for(c=f.bitLength(e)/8,c<=65279?l=[f.partial(16,c)]:c<=4294967295&&(l=f.concat([f.partial(16,65534)],[c])),l=f.concat(l,e),h=0;h<l.length;h+=4)a=t.encrypt(u(a,l.slice(h,h+4).concat([0,0,0])));return a},_computeTag:function(t,e,i,r,n,s){var a,c,h=o.bitArray,l=h._xor4;if(n/=8,n%2||n<4||n>16)throw new o.exception.invalid("ccm: invalid tag length");if(r.length>4294967295||e.length>4294967295)throw new o.exception.bug("ccm: can't deal with 4GiB or more data");for(a=o.mode.ccm._macAdditionalData(t,r,i,n,h.bitLength(e)/8,s),c=0;c<e.length;c+=4)a=t.encrypt(l(a,e.slice(c,c+4).concat([0,0,0])));return h.clamp(a,n*8)},_ctrMode:function(t,e,i,r,n,s){var a,c,h=o.bitArray,l=h._xor4,f,u=e.length,d=h.bitLength(e),m=u/50,y=m;if(f=h.concat([h.partial(8,s-1)],i).concat([0,0,0]).slice(0,4),r=h.bitSlice(l(r,t.encrypt(f)),0,n),!u)return{tag:r,data:[]};for(c=0;c<u;c+=4)c>m&&(o.mode.ccm._callProgressListener(c/u),m+=y),f[3]++,a=t.encrypt(f),e[c]^=a[0],e[c+1]^=a[1],e[c+2]^=a[2],e[c+3]^=a[3];return{tag:r,data:h.clamp(e,d)}}};o.misc.hmac=function(t,e){this._hash=e=e||o.hash.sha256;var i=[[],[]],r,n=e.prototype.blockSize/32;for(this._baseHash=[new e,new e],t.length>n&&(t=e.hash(t)),r=0;r<n;r++)i[0][r]=t[r]^909522486,i[1][r]=t[r]^1549556828;this._baseHash[0].update(i[0]),this._baseHash[1].update(i[1]),this._resultHash=new e(this._baseHash[0])};o.misc.hmac.prototype.encrypt=o.misc.hmac.prototype.mac=function(t){if(this._updated)throw new o.exception.invalid("encrypt on already updated hmac called!");return this.update(t),this.digest(t)};o.misc.hmac.prototype.reset=function(){this._resultHash=new this._hash(this._baseHash[0]),this._updated=!1};o.misc.hmac.prototype.update=function(t){this._updated=!0,this._resultHash.update(t)};o.misc.hmac.prototype.digest=function(){var t=this._resultHash.finalize(),e=new this._hash(this._baseHash[1]).update(t).finalize();return this.reset(),e};o.misc.pbkdf2=function(t,e,i,r,n){if(i=i||1e4,r<0||i<0)throw new o.exception.invalid("invalid params to pbkdf2");typeof t=="string"&&(t=o.codec.utf8String.toBits(t)),typeof e=="string"&&(e=o.codec.utf8String.toBits(e)),n=n||o.misc.hmac;var s=new n(t),a,c,h,l,f,u=[],d=o.bitArray;for(f=1;32*u.length<(r||1);f++){for(a=c=s.encrypt(d.concat(e,[f])),h=1;h<i;h++)for(c=s.encrypt(c),l=0;l<c.length;l++)a[l]^=c[l];u=u.concat(a)}return r&&(u=d.clamp(u,r)),u};o.prng=function(t){this._pools=[new o.hash.sha256],this._poolEntropy=[0],this._reseedCount=0,this._robins={},this._eventId=0,this._collectorIds={},this._collectorIdNext=0,this._strength=0,this._poolStrength=0,this._nextReseed=0,this._key=[0,0,0,0,0,0,0,0],this._counter=[0,0,0,0],this._cipher=void 0,this._defaultParanoia=t,this._collectorsStarted=!1,this._callbacks={progress:{},seeded:{}},this._callbackI=0,this._NOT_READY=0,this._READY=1,this._REQUIRES_RESEED=2,this._MAX_WORDS_PER_BURST=65536,this._PARANOIA_LEVELS=[0,48,64,96,128,192,256,384,512,768,1024],this._MILLISECONDS_PER_RESEED=3e4,this._BITS_PER_RESEED=80};o.prng.prototype={randomWords:function(t,e){var i=[],r,n=this.isReady(e),s;if(n===this._NOT_READY)throw new o.exception.notReady("generator isn't seeded");for(n&this._REQUIRES_RESEED&&this._reseedFromPools(!(n&this._READY)),r=0;r<t;r+=4)(r+1)%this._MAX_WORDS_PER_BURST===0&&this._gate(),s=this._gen4words(),i.push(s[0],s[1],s[2],s[3]);return this._gate(),i.slice(0,t)},setDefaultParanoia:function(t,e){if(t===0&&e!=="Setting paranoia=0 will ruin your security; use it only for testing")throw new o.exception.invalid("Setting paranoia=0 will ruin your security; use it only for testing");this._defaultParanoia=t},addEntropy:function(t,e,i){i=i||"user";var r,n,s,a=new Date().valueOf(),c=this._robins[i],h=this.isReady(),l=0,f;switch(r=this._collectorIds[i],r===void 0&&(r=this._collectorIds[i]=this._collectorIdNext++),c===void 0&&(c=this._robins[i]=0),this._robins[i]=(this._robins[i]+1)%this._pools.length,typeof t){case"number":e===void 0&&(e=1),this._pools[c].update([r,this._eventId++,1,e,a,1,t|0]);break;case"object":if(f=Object.prototype.toString.call(t),f==="[object Uint32Array]"){for(s=[],n=0;n<t.length;n++)s.push(t[n]);t=s}else for(f!=="[object Array]"&&(l=1),n=0;n<t.length&&!l;n++)typeof t[n]!="number"&&(l=1);if(!l){if(e===void 0)for(e=0,n=0;n<t.length;n++)for(s=t[n];s>0;)e++,s=s>>>1;this._pools[c].update([r,this._eventId++,2,e,a,t.length].concat(t))}break;case"string":e===void 0&&(e=t.length),this._pools[c].update([r,this._eventId++,3,e,a,t.length]),this._pools[c].update(t);break;default:l=1}if(l)throw new o.exception.bug("random: addEntropy only supports number, array of numbers or string");this._poolEntropy[c]+=e,this._poolStrength+=e,h===this._NOT_READY&&(this.isReady()!==this._NOT_READY&&this._fireEvent("seeded",Math.max(this._strength,this._poolStrength)),this._fireEvent("progress",this.getProgress()))},isReady:function(t){var e=this._PARANOIA_LEVELS[t!==void 0?t:this._defaultParanoia];return this._strength&&this._strength>=e?this._poolEntropy[0]>this._BITS_PER_RESEED&&new Date().valueOf()>this._nextReseed?this._REQUIRES_RESEED|this._READY:this._READY:this._poolStrength>=e?this._REQUIRES_RESEED|this._NOT_READY:this._NOT_READY},getProgress:function(t){var e=this._PARANOIA_LEVELS[t||this._defaultParanoia];return this._strength>=e||this._poolStrength>e?1:this._poolStrength/e},startCollectors:function(){if(!this._collectorsStarted){if(this._eventListener={loadTimeCollector:this._bind(this._loadTimeCollector),mouseCollector:this._bind(this._mouseCollector),keyboardCollector:this._bind(this._keyboardCollector),accelerometerCollector:this._bind(this._accelerometerCollector),touchCollector:this._bind(this._touchCollector)},window.addEventListener)window.addEventListener("load",this._eventListener.loadTimeCollector,!1),window.addEventListener("mousemove",this._eventListener.mouseCollector,!1),window.addEventListener("keypress",this._eventListener.keyboardCollector,!1),window.addEventListener("devicemotion",this._eventListener.accelerometerCollector,!1),window.addEventListener("touchmove",this._eventListener.touchCollector,!1);else if(document.attachEvent)document.attachEvent("onload",this._eventListener.loadTimeCollector),document.attachEvent("onmousemove",this._eventListener.mouseCollector),document.attachEvent("keypress",this._eventListener.keyboardCollector);else throw new o.exception.bug("can't attach event");this._collectorsStarted=!0}},stopCollectors:function(){this._collectorsStarted&&(window.removeEventListener?(window.removeEventListener("load",this._eventListener.loadTimeCollector,!1),window.removeEventListener("mousemove",this._eventListener.mouseCollector,!1),window.removeEventListener("keypress",this._eventListener.keyboardCollector,!1),window.removeEventListener("devicemotion",this._eventListener.accelerometerCollector,!1),window.removeEventListener("touchmove",this._eventListener.touchCollector,!1)):document.detachEvent&&(document.detachEvent("onload",this._eventListener.loadTimeCollector),document.detachEvent("onmousemove",this._eventListener.mouseCollector),document.detachEvent("keypress",this._eventListener.keyboardCollector)),this._collectorsStarted=!1)},addEventListener:function(t,e){this._callbacks[t][this._callbackI++]=e},removeEventListener:function(t,e){var i,r,n=this._callbacks[t],s=[];for(r in n)n.hasOwnProperty(r)&&n[r]===e&&s.push(r);for(i=0;i<s.length;i++)r=s[i],delete n[r]},_bind:function(t){var e=this;return function(){t.apply(e,arguments)}},_gen4words:function(){for(var t=0;t<4&&(this._counter[t]=this._counter[t]+1|0,!this._counter[t]);t++);return this._cipher.encrypt(this._counter)},_gate:function(){this._key=this._gen4words().concat(this._gen4words()),this._cipher=new o.cipher.aes(this._key)},_reseed:function(t){this._key=o.hash.sha256.hash(this._key.concat(t)),this._cipher=new o.cipher.aes(this._key);for(var e=0;e<4&&(this._counter[e]=this._counter[e]+1|0,!this._counter[e]);e++);},_reseedFromPools:function(t){var e=[],i=0,r;for(this._nextReseed=e[0]=new Date().valueOf()+this._MILLISECONDS_PER_RESEED,r=0;r<16;r++)e.push(Math.random()*4294967296|0);for(r=0;r<this._pools.length&&(e=e.concat(this._pools[r].finalize()),i+=this._poolEntropy[r],this._poolEntropy[r]=0,!(!t&&this._reseedCount&1<<r));r++);this._reseedCount>=1<<this._pools.length&&(this._pools.push(new o.hash.sha256),this._poolEntropy.push(0)),this._poolStrength-=i,i>this._strength&&(this._strength=i),this._reseedCount++,this._reseed(e)},_keyboardCollector:function(){this._addCurrentTimeToEntropy(1)},_mouseCollector:function(t){var e,i;try{e=t.x||t.clientX||t.offsetX||0,i=t.y||t.clientY||t.offsetY||0}catch{e=0,i=0}e!=0&&i!=0&&this.addEntropy([e,i],2,"mouse"),this._addCurrentTimeToEntropy(0)},_touchCollector:function(t){var e=t.touches[0]||t.changedTouches[0],i=e.pageX||e.clientX,r=e.pageY||e.clientY;this.addEntropy([i,r],1,"touch"),this._addCurrentTimeToEntropy(0)},_loadTimeCollector:function(){this._addCurrentTimeToEntropy(2)},_addCurrentTimeToEntropy:function(t){typeof window<"u"&&window.performance&&typeof window.performance.now=="function"?this.addEntropy(window.performance.now(),t,"loadtime"):this.addEntropy(new Date().valueOf(),t,"loadtime")},_accelerometerCollector:function(t){var e=t.accelerationIncludingGravity.x||t.accelerationIncludingGravity.y||t.accelerationIncludingGravity.z;if(window.orientation){var i=window.orientation;typeof i=="number"&&this.addEntropy(i,1,"accelerometer")}e&&this.addEntropy(e,2,"accelerometer"),this._addCurrentTimeToEntropy(0)},_fireEvent:function(t,e){var i,r=o.random._callbacks[t],n=[];for(i in r)r.hasOwnProperty(i)&&n.push(r[i]);for(i=0;i<n.length;i++)n[i](e)}};o.random=new o.prng(6);(function(){function t(){try{return require("crypto")}catch{return null}}try{var e,i,r;if(typeof $<"u"&&$.exports&&(i=t())&&i.randomBytes)e=i.randomBytes(1024/8),e=new Uint32Array(new Uint8Array(e).buffer),o.random.addEntropy(e,1024,"crypto.randomBytes");else if(typeof window<"u"&&typeof Uint32Array<"u"){if(r=new Uint32Array(32),window.crypto&&window.crypto.getRandomValues)window.crypto.getRandomValues(r);else if(window.msCrypto&&window.msCrypto.getRandomValues)window.msCrypto.getRandomValues(r);else return;o.random.addEntropy(r,1024,"crypto.getRandomValues")}}catch(n){typeof window<"u"&&window.console&&(console.log("There was an error collecting entropy from the browser:"),console.log(n))}})();o.json={defaults:{v:1,iter:1e4,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},_encrypt:function(t,e,i,r){i=i||{},r=r||{};var n=o.json,s=n._add({iv:o.random.randomWords(4,0)},n.defaults),a,c,h;if(n._add(s,i),h=s.adata,typeof s.salt=="string"&&(s.salt=o.codec.base64.toBits(s.salt)),typeof s.iv=="string"&&(s.iv=o.codec.base64.toBits(s.iv)),!o.mode[s.mode]||!o.cipher[s.cipher]||typeof t=="string"&&s.iter<=100||s.ts!==64&&s.ts!==96&&s.ts!==128||s.ks!==128&&s.ks!==192&&s.ks!==256||s.iv.length<2||s.iv.length>4)throw new o.exception.invalid("json encrypt: invalid parameters");return typeof t=="string"?(a=o.misc.cachedPbkdf2(t,s),t=a.key.slice(0,s.ks/32),s.salt=a.salt):o.ecc&&t instanceof o.ecc.elGamal.publicKey&&(a=t.kem(),s.kemtag=a.tag,t=a.key.slice(0,s.ks/32)),typeof e=="string"&&(e=o.codec.utf8String.toBits(e)),typeof h=="string"&&(s.adata=h=o.codec.utf8String.toBits(h)),c=new o.cipher[s.cipher](t),n._add(r,s),r.key=t,s.mode==="ccm"&&o.arrayBuffer&&o.arrayBuffer.ccm&&e instanceof ArrayBuffer?s.ct=o.arrayBuffer.ccm.encrypt(c,e,s.iv,h,s.ts):s.ct=o.mode[s.mode].encrypt(c,e,s.iv,h,s.ts),s},encrypt:function(t,e,i,r){var n=o.json,s=n._encrypt.apply(n,arguments);return n.encode(s)},_decrypt:function(t,e,i,r){i=i||{},r=r||{};var n=o.json,s=n._add(n._add(n._add({},n.defaults),e),i,!0),a,c,h,l=s.adata;if(typeof s.salt=="string"&&(s.salt=o.codec.base64.toBits(s.salt)),typeof s.iv=="string"&&(s.iv=o.codec.base64.toBits(s.iv)),!o.mode[s.mode]||!o.cipher[s.cipher]||typeof t=="string"&&s.iter<=100||s.ts!==64&&s.ts!==96&&s.ts!==128||s.ks!==128&&s.ks!==192&&s.ks!==256||!s.iv||s.iv.length<2||s.iv.length>4)throw new o.exception.invalid("json decrypt: invalid parameters");return typeof t=="string"?(c=o.misc.cachedPbkdf2(t,s),t=c.key.slice(0,s.ks/32),s.salt=c.salt):o.ecc&&t instanceof o.ecc.elGamal.secretKey&&(t=t.unkem(o.codec.base64.toBits(s.kemtag)).slice(0,s.ks/32)),typeof l=="string"&&(l=o.codec.utf8String.toBits(l)),h=new o.cipher[s.cipher](t),s.mode==="ccm"&&o.arrayBuffer&&o.arrayBuffer.ccm&&s.ct instanceof ArrayBuffer?a=o.arrayBuffer.ccm.decrypt(h,s.ct,s.iv,s.tag,l,s.ts):a=o.mode[s.mode].decrypt(h,s.ct,s.iv,l,s.ts),n._add(r,s),r.key=t,i.raw===1?a:o.codec.utf8String.fromBits(a)},decrypt:function(t,e,i,r){var n=o.json;return n._decrypt(t,n.decode(e),i,r)},encode:function(t){var e,i="{",r="";for(e in t)if(t.hasOwnProperty(e)){if(!e.match(/^[a-z0-9]+$/i))throw new o.exception.invalid("json encode: invalid property name");switch(i+=r+'"'+e+'":',r=",",typeof t[e]){case"number":case"boolean":i+=t[e];break;case"string":i+='"'+escape(t[e])+'"';break;case"object":i+='"'+o.codec.base64.fromBits(t[e],0)+'"';break;default:throw new o.exception.bug("json encode: unsupported type")}}return i+"}"},decode:function(t){if(t=t.replace(/\s/g,""),!t.match(/^\{.*\}$/))throw new o.exception.invalid("json decode: this isn't json!");var e=t.replace(/^\{|\}$/g,"").split(/,/),i={},r,n;for(r=0;r<e.length;r++){if(!(n=e[r].match(/^\s*(?:(["']?)([a-z][a-z0-9]*)\1)\s*:\s*(?:(-?\d+)|"([a-z0-9+\/%*_.@=\-]*)"|(true|false))$/i)))throw new o.exception.invalid("json decode: this isn't json!");n[3]!=null?i[n[2]]=parseInt(n[3],10):n[4]!=null?i[n[2]]=n[2].match(/^(ct|adata|salt|iv)$/)?o.codec.base64.toBits(n[4]):unescape(n[4]):n[5]!=null&&(i[n[2]]=n[5]==="true")}return i},_add:function(t,e,i){if(t===void 0&&(t={}),e===void 0)return t;var r;for(r in e)if(e.hasOwnProperty(r)){if(i&&t[r]!==void 0&&t[r]!==e[r])throw new o.exception.invalid("required parameter overridden");t[r]=e[r]}return t},_subtract:function(t,e){var i={},r;for(r in t)t.hasOwnProperty(r)&&t[r]!==e[r]&&(i[r]=t[r]);return i},_filter:function(t,e){var i={},r;for(r=0;r<e.length;r++)t[e[r]]!==void 0&&(i[e[r]]=t[e[r]]);return i}};o.encrypt=o.json.encrypt;o.decrypt=o.json.decrypt;o.misc._pbkdf2Cache={};o.misc.cachedPbkdf2=function(t,e){var i=o.misc._pbkdf2Cache,r,n,s,a;return e=e||{},a=e.iter||1e3,n=i[t]=i[t]||{},r=n[a]=n[a]||{firstSalt:e.salt&&e.salt.length?e.salt.slice(0):o.random.randomWords(2,0)},s=e.salt===void 0?r.firstSalt:e.salt,r[s]=r[s]||o.misc.pbkdf2(t,s,e.iter),{key:r[s].slice(0),salt:s.slice(0)}};o.bn=function(t){this.initWith(t)};o.bn.prototype={radix:24,maxMul:8,_class:o.bn,copy:function(){return new this._class(this)},initWith:function(t){var e=0,i;switch(typeof t){case"object":this.limbs=t.limbs.slice(0);break;case"number":this.limbs=[t],this.normalize();break;case"string":for(t=t.replace(/^0x/,""),this.limbs=[],i=this.radix/4,e=0;e<t.length;e+=i)this.limbs.push(parseInt(t.substring(Math.max(t.length-e-i,0),t.length-e),16));break;default:this.limbs=[0]}return this},equals:function(t){typeof t=="number"&&(t=new this._class(t));var e=0,i;for(this.fullReduce(),t.fullReduce(),i=0;i<this.limbs.length||i<t.limbs.length;i++)e|=this.getLimb(i)^t.getLimb(i);return e===0},getLimb:function(t){return t>=this.limbs.length?0:this.limbs[t]},greaterEquals:function(t){typeof t=="number"&&(t=new this._class(t));var e=0,i=0,r,n,s;for(r=Math.max(this.limbs.length,t.limbs.length)-1;r>=0;r--)n=this.getLimb(r),s=t.getLimb(r),i|=s-n&~e,e|=n-s&~i;return(i|~e)>>>31},toString:function(){this.fullReduce();var t="",e,i,r=this.limbs;for(e=0;e<this.limbs.length;e++){for(i=r[e].toString(16);e<this.limbs.length-1&&i.length<6;)i="0"+i;t=i+t}return"0x"+t},addM:function(t){typeof t!="object"&&(t=new this._class(t));var e,i=this.limbs,r=t.limbs;for(e=i.length;e<r.length;e++)i[e]=0;for(e=0;e<r.length;e++)i[e]+=r[e];return this},doubleM:function(){var t,e=0,i,r=this.radix,n=this.radixMask,s=this.limbs;for(t=0;t<s.length;t++)i=s[t],i=i+i+e,s[t]=i&n,e=i>>r;return e&&s.push(e),this},halveM:function(){var t,e=0,i,r=this.radix,n=this.limbs;for(t=n.length-1;t>=0;t--)i=n[t],n[t]=i+e>>1,e=(i&1)<<r;return n[n.length-1]||n.pop(),this},subM:function(t){typeof t!="object"&&(t=new this._class(t));var e,i=this.limbs,r=t.limbs;for(e=i.length;e<r.length;e++)i[e]=0;for(e=0;e<r.length;e++)i[e]-=r[e];return this},mod:function(t){var e=!this.greaterEquals(new o.bn(0));t=new o.bn(t).normalize();var i=new o.bn(this).normalize(),r=0;for(e&&(i=new o.bn(0).subM(i).normalize());i.greaterEquals(t);r++)t.doubleM();for(e&&(i=t.sub(i).normalize());r>0;r--)t.halveM(),i.greaterEquals(t)&&i.subM(t).normalize();return i.trim()},inverseMod:function(t){var e=new o.bn(1),i=new o.bn(0),r=new o.bn(this),n=new o.bn(t),s,a,c=1;if(!(t.limbs[0]&1))throw new o.exception.invalid("inverseMod: p must be odd");do for(r.limbs[0]&1&&(r.greaterEquals(n)||(s=r,r=n,n=s,s=e,e=i,i=s),r.subM(n),r.normalize(),e.greaterEquals(i)||e.addM(t),e.subM(i)),r.halveM(),e.limbs[0]&1&&e.addM(t),e.normalize(),e.halveM(),a=c=0;a<r.limbs.length;a++)c|=r.limbs[a];while(c);if(!n.equals(1))throw new o.exception.invalid("inverseMod: p and x must be relatively prime");return i},add:function(t){return this.copy().addM(t)},sub:function(t){return this.copy().subM(t)},mul:function(t){typeof t=="number"?t=new this._class(t):t.normalize(),this.normalize();var e,i,r=this.limbs,n=t.limbs,s=r.length,a=n.length,c=new this._class,h=c.limbs,l,f=this.maxMul;for(e=0;e<this.limbs.length+t.limbs.length+1;e++)h[e]=0;for(e=0;e<s;e++){for(l=r[e],i=0;i<a;i++)h[e+i]+=l*n[i];--f||(f=this.maxMul,c.cnormalize())}return c.cnormalize().reduce()},square:function(){return this.mul(this)},power:function(t){t=new o.bn(t).normalize().trim().limbs;var e,i,r=new this._class(1),n=this;for(e=0;e<t.length;e++)for(i=0;i<this.radix&&(t[e]&1<<i&&(r=r.mul(n)),!(e==t.length-1&&t[e]>>i+1==0));i++)n=n.square();return r},mulmod:function(t,e){return this.mod(e).mul(t.mod(e)).mod(e)},powermod:function(t,e){if(t=new o.bn(t),e=new o.bn(e),(e.limbs[0]&1)==1){var i=this.montpowermod(t,e);if(i!=!1)return i}var r,n,s=t.normalize().trim().limbs,a=new this._class(1),c=this;for(r=0;r<s.length;r++)for(n=0;n<this.radix&&(s[r]&1<<n&&(a=a.mulmod(c,e)),!(r==s.length-1&&s[r]>>n+1==0));n++)c=c.mulmod(c,e);return a},montpowermod:function(t,e){t=new o.bn(t).normalize().trim(),e=new o.bn(e);var i,r,n=this.radix,s=new this._class(1),a=this.copy(),c,h,l,f=t.bitLength();for(c=new o.bn({limbs:e.copy().normalize().trim().limbs.map(function(){return 0})}),h=this.radix;h>0;h--)if((e.limbs[e.limbs.length-1]>>h&1)==1){c.limbs[c.limbs.length-1]=1<<h;break}if(f==0)return this;f<18?l=1:f<48?l=3:f<144?l=4:f<768?l=5:l=6;for(var u=c.copy(),d=e.copy(),m=new o.bn(1),y=new o.bn(0),b=c.copy();b.greaterEquals(1);)b.halveM(),(m.limbs[0]&1)==0?(m.halveM(),y.halveM()):(m.addM(d),m.halveM(),y.halveM(),y.addM(u));m=m.normalize(),y=y.normalize(),u.doubleM();var p=u.mulmod(u,e);if(!u.mul(m).sub(e.mul(y)).equals(1))return!1;var w=function(g){return k(g,p)},k=function(g,R){var v,C,x,A,I=(1<<h+1)-1;for(C=g.mul(R),x=C.mul(y),x.limbs=x.limbs.slice(0,c.limbs.length),x.limbs.length==c.limbs.length&&(x.limbs[c.limbs.length-1]&=I),x=x.mul(e),A=C.add(x).normalize().trim(),A.limbs=A.limbs.slice(c.limbs.length-1),v=0;v<A.limbs.length;v++)v>0&&(A.limbs[v-1]|=(A.limbs[v]&I)<<n-h-1),A.limbs[v]=A.limbs[v]>>h+1;return A.greaterEquals(e)&&A.subM(e),A},z=function(g){return k(g,1)};a=w(a),s=w(s);var S,E={},H=(1<<l-1)-1;for(E[1]=a.copy(),E[2]=k(a,a),S=1;S<=H;S++)E[2*S+1]=k(E[2*S-1],E[2]);var L=function(g,R){var v=R%g.radix;return(g.limbs[Math.floor(R/g.radix)]&1<<v)>>v};for(i=t.bitLength()-1;i>=0;)if(L(t,i)==0)s=k(s,s),i=i-1;else{for(var F=i-l+1;L(t,F)==0;)F++;var D=0;for(r=F;r<=i;r++)D+=L(t,r)<<r-F,s=k(s,s);s=k(s,E[D]),i=F-1}return z(s)},trim:function(){var t=this.limbs,e;do e=t.pop();while(t.length&&e===0);return t.push(e),this},reduce:function(){return this},fullReduce:function(){return this.normalize()},normalize:function(){var t=0,e,i=this.placeVal,r=this.ipv,n,s,a=this.limbs,c=a.length,h=this.radixMask;for(e=0;e<c||t!==0&&t!==-1;e++)n=(a[e]||0)+t,s=a[e]=n&h,t=(n-s)*r;return t===-1&&(a[e-1]-=i),this.trim(),this},cnormalize:function(){var t=0,e,i=this.ipv,r,n,s=this.limbs,a=s.length,c=this.radixMask;for(e=0;e<a-1;e++)r=s[e]+t,n=s[e]=r&c,t=(r-n)*i;return s[e]+=t,this},toBits:function(t){this.fullReduce(),t=t||this.exponent||this.bitLength();var e=Math.floor((t-1)/24),i=o.bitArray,r=(t+7&-8)%this.radix||this.radix,n=[i.partial(r,this.getLimb(e))];for(e--;e>=0;e--)n=i.concat(n,[i.partial(Math.min(this.radix,t),this.getLimb(e))]),t-=this.radix;return n},bitLength:function(){this.fullReduce();for(var t=this.radix*(this.limbs.length-1),e=this.limbs[this.limbs.length-1];e;e>>>=1)t++;return t+7&-8}};o.bn.fromBits=function(t){var e=this,i=new e,r=[],n=o.bitArray,s=this.prototype,a=Math.min(this.bitLength||4294967296,n.bitLength(t)),c=a%s.radix||s.radix;for(r[0]=n.extract(t,0,c);c<a;c+=s.radix)r.unshift(n.extract(t,c,s.radix));return i.limbs=r,i};o.bn.prototype.ipv=1/(o.bn.prototype.placeVal=Math.pow(2,o.bn.prototype.radix));o.bn.prototype.radixMask=(1<<o.bn.prototype.radix)-1;o.bn.pseudoMersennePrime=function(t,e){function i(c){this.initWith(c)}var r=i.prototype=new o.bn,n,s,a;for(a=r.modOffset=Math.ceil(s=t/r.radix),r.exponent=t,r.offset=[],r.factor=[],r.minOffset=a,r.fullMask=0,r.fullOffset=[],r.fullFactor=[],r.modulus=i.modulus=new o.bn(Math.pow(2,t)),r.fullMask=0|-Math.pow(2,t%r.radix),n=0;n<e.length;n++)r.offset[n]=Math.floor(e[n][0]/r.radix-s),r.fullOffset[n]=Math.floor(e[n][0]/r.radix)-a+1,r.factor[n]=e[n][1]*Math.pow(1/2,t-e[n][0]+r.offset[n]*r.radix),r.fullFactor[n]=e[n][1]*Math.pow(1/2,t-e[n][0]+r.fullOffset[n]*r.radix),r.modulus.addM(new o.bn(Math.pow(2,e[n][0])*e[n][1])),r.minOffset=Math.min(r.minOffset,-r.offset[n]);return r._class=i,r.modulus.cnormalize(),r.reduce=function(){var c,h,l,f=this.modOffset,u=this.limbs,d=this.offset,m=this.offset.length,y=this.factor,b;for(c=this.minOffset;u.length>f;){for(l=u.pop(),b=u.length,h=0;h<m;h++)u[b+d[h]]-=y[h]*l;c--,c||(u.push(0),this.cnormalize(),c=this.minOffset)}return this.cnormalize(),this},r._strongReduce=r.fullMask===-1?r.reduce:function(){var c=this.limbs,h=c.length-1,l,f;if(this.reduce(),h===this.modOffset-1){for(f=c[h]&this.fullMask,c[h]-=f,l=0;l<this.fullOffset.length;l++)c[h+this.fullOffset[l]]-=this.fullFactor[l]*f;this.normalize()}},r.fullReduce=function(){var c,h;for(this._strongReduce(),this.addM(this.modulus),this.addM(this.modulus),this.normalize(),this._strongReduce(),h=this.limbs.length;h<this.modOffset;h++)this.limbs[h]=0;for(c=this.greaterEquals(this.modulus),h=0;h<this.limbs.length;h++)this.limbs[h]-=this.modulus.limbs[h]*c;return this.cnormalize(),this},r.inverse=function(){return this.power(this.modulus.sub(2))},i.fromBits=o.bn.fromBits,i};var j=o.bn.pseudoMersennePrime;o.bn.prime={p127:j(127,[[0,-1]]),p25519:j(255,[[0,-19]]),p192k:j(192,[[32,-1],[12,-1],[8,-1],[7,-1],[6,-1],[3,-1],[0,-1]]),p224k:j(224,[[32,-1],[12,-1],[11,-1],[9,-1],[7,-1],[4,-1],[1,-1],[0,-1]]),p256k:j(256,[[32,-1],[9,-1],[8,-1],[7,-1],[6,-1],[4,-1],[0,-1]]),p192:j(192,[[0,-1],[64,-1]]),p224:j(224,[[0,1],[96,-1]]),p256:j(256,[[0,-1],[96,1],[192,1],[224,-1]]),p384:j(384,[[0,-1],[32,1],[96,-1],[128,-1]]),p521:j(521,[[0,-1]])};o.bn.random=function(t,e){typeof t!="object"&&(t=new o.bn(t));for(var i,r,n=t.limbs.length,s=t.limbs[n-1]+1,a=new o.bn;;){do i=o.random.randomWords(n,e),i[n-1]<0&&(i[n-1]+=4294967296);while(Math.floor(i[n-1]/s)===Math.floor(4294967296/s));for(i[n-1]%=s,r=0;r<n-1;r++)i[r]&=t.radixMask;if(a.limbs=i,!a.greaterEquals(t))return a}};o.ecc={};o.ecc.point=function(t,e,i){e===void 0?this.isIdentity=!0:(e instanceof o.bn&&(e=new t.field(e)),i instanceof o.bn&&(i=new t.field(i)),this.x=e,this.y=i,this.isIdentity=!1),this.curve=t};o.ecc.point.prototype={toJac:function(){return new o.ecc.pointJac(this.curve,this.x,this.y,new this.curve.field(1))},mult:function(t){return this.toJac().mult(t,this).toAffine()},mult2:function(t,e,i){return this.toJac().mult2(t,this,e,i).toAffine()},multiples:function(){var t,e,i;if(this._multiples===void 0)for(i=this.toJac().doubl(),t=this._multiples=[new o.ecc.point(this.curve),this,i.toAffine()],e=3;e<16;e++)i=i.add(this),t.push(i.toAffine());return this._multiples},negate:function(){var t=new this.curve.field(0).sub(this.y).normalize().reduce();return new o.ecc.point(this.curve,this.x,t)},isValid:function(){return this.y.square().equals(this.curve.b.add(this.x.mul(this.curve.a.add(this.x.square()))))},toBits:function(){return o.bitArray.concat(this.x.toBits(),this.y.toBits())}};o.ecc.pointJac=function(t,e,i,r){e===void 0?this.isIdentity=!0:(this.x=e,this.y=i,this.z=r,this.isIdentity=!1),this.curve=t};o.ecc.pointJac.prototype={add:function(t){var e=this,i,r,n,s,a,c,h,l,f,u,d;if(e.curve!==t.curve)throw new o.exception.invalid("sjcl.ecc.add(): Points must be on the same curve to add them!");return e.isIdentity?t.toJac():t.isIdentity?e:(i=e.z.square(),r=t.x.mul(i).subM(e.x),r.equals(0)?e.y.equals(t.y.mul(i.mul(e.z)))?e.doubl():new o.ecc.pointJac(e.curve):(n=t.y.mul(i.mul(e.z)).subM(e.y),s=r.square(),a=n.square(),c=r.square().mul(r).addM(e.x.add(e.x).mul(s)),h=a.subM(c),l=e.x.mul(s).subM(h).mul(n),f=e.y.mul(r.square().mul(r)),u=l.subM(f),d=e.z.mul(r),new o.ecc.pointJac(this.curve,h,u,d)))},doubl:function(){if(this.isIdentity)return this;var t=this.y.square(),e=t.mul(this.x.mul(4)),i=t.square().mul(8),r=this.z.square(),n=this.curve.a.toString()==new o.bn(-3).toString()?this.x.sub(r).mul(3).mul(this.x.add(r)):this.x.square().mul(3).add(r.square().mul(this.curve.a)),s=n.square().subM(e).subM(e),a=e.sub(s).mul(n).subM(i),c=this.y.add(this.y).mul(this.z);return new o.ecc.pointJac(this.curve,s,a,c)},toAffine:function(){if(this.isIdentity||this.z.equals(0))return new o.ecc.point(this.curve);var t=this.z.inverse(),e=t.square();return new o.ecc.point(this.curve,this.x.mul(e).fullReduce(),this.y.mul(e.mul(t)).fullReduce())},mult:function(t,e){typeof t=="number"?t=[t]:t.limbs!==void 0&&(t=t.normalize().limbs);var i,r,n=new o.ecc.point(this.curve).toJac(),s=e.multiples();for(i=t.length-1;i>=0;i--)for(r=o.bn.prototype.radix-4;r>=0;r-=4)n=n.doubl().doubl().doubl().doubl().add(s[t[i]>>r&15]);return n},mult2:function(t,e,i,r){typeof t=="number"?t=[t]:t.limbs!==void 0&&(t=t.normalize().limbs),typeof i=="number"?i=[i]:i.limbs!==void 0&&(i=i.normalize().limbs);var n,s,a=new o.ecc.point(this.curve).toJac(),c=e.multiples(),h=r.multiples(),l,f;for(n=Math.max(t.length,i.length)-1;n>=0;n--)for(l=t[n]|0,f=i[n]|0,s=o.bn.prototype.radix-4;s>=0;s-=4)a=a.doubl().doubl().doubl().doubl().add(c[l>>s&15]).add(h[f>>s&15]);return a},negate:function(){return this.toAffine().negate().toJac()},isValid:function(){var t=this.z.square(),e=t.square(),i=e.mul(t);return this.y.square().equals(this.curve.b.mul(i).add(this.x.mul(this.curve.a.mul(e).add(this.x.square()))))}};o.ecc.curve=function(t,e,i,r,n,s){this.field=t,this.r=new o.bn(e),this.a=new t(i),this.b=new t(r),this.G=new o.ecc.point(this,new t(n),new t(s))};o.ecc.curve.prototype.fromBits=function(t){var e=o.bitArray,i=this.field.prototype.exponent+7&-8,r=new o.ecc.point(this,this.field.fromBits(e.bitSlice(t,0,i)),this.field.fromBits(e.bitSlice(t,i,2*i)));if(!r.isValid())throw new o.exception.corrupt("not on the curve!");return r};o.ecc.curves={c192:new o.ecc.curve(o.bn.prime.p192,"0xffffffffffffffffffffffff99def836146bc9b1b4d22831",-3,"0x64210519e59c80e70fa7e9ab72243049feb8deecc146b9b1","0x188da80eb03090f67cbf20eb43a18800f4ff0afd82ff1012","0x07192b95ffc8da78631011ed6b24cdd573f977a11e794811"),c224:new o.ecc.curve(o.bn.prime.p224,"0xffffffffffffffffffffffffffff16a2e0b8f03e13dd29455c5c2a3d",-3,"0xb4050a850c04b3abf54132565044b0b7d7bfd8ba270b39432355ffb4","0xb70e0cbd6bb4bf7f321390b94a03c1d356c21122343280d6115c1d21","0xbd376388b5f723fb4c22dfe6cd4375a05a07476444d5819985007e34"),c256:new o.ecc.curve(o.bn.prime.p256,"0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551",-3,"0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b","0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296","0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),c384:new o.ecc.curve(o.bn.prime.p384,"0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973",-3,"0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef","0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7","0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f"),c521:new o.ecc.curve(o.bn.prime.p521,"0x1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA51868783BF2F966B7FCC0148F709A5D03BB5C9B8899C47AEBB6FB71E91386409",-3,"0x051953EB9618E1C9A1F929A21A0B68540EEA2DA725B99B315F3B8B489918EF109E156193951EC7E937B1652C0BD3BB1BF073573DF883D2C34F1EF451FD46B503F00","0xC6858E06B70404E9CD9E3ECB662395B4429C648139053FB521F828AF606B4D3DBAA14B5E77EFE75928FE1DC127A2FFA8DE3348B3C1856A429BF97E7E31C2E5BD66","0x11839296A789A3BC0045C8A5FB42C7D1BD998F54449579B446817AFBD17273E662C97EE72995EF42640C550B9013FAD0761353C7086A272C24088BE94769FD16650"),k192:new o.ecc.curve(o.bn.prime.p192k,"0xfffffffffffffffffffffffe26f2fc170f69466a74defd8d",0,3,"0xdb4ff10ec057e9ae26b07d0280b7f4341da5d1b1eae06c7d","0x9b2f2f6d9c5628a7844163d015be86344082aa88d95e2f9d"),k224:new o.ecc.curve(o.bn.prime.p224k,"0x010000000000000000000000000001dce8d2ec6184caf0a971769fb1f7",0,5,"0xa1455b334df099df30fc28a169a467e9e47075a90f7e650eb6b7a45c","0x7e089fed7fba344282cafbd6f7e319f7c0b0bd59e2ca4bdb556d61a5"),k256:new o.ecc.curve(o.bn.prime.p256k,"0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141",0,7,"0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798","0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")};o.ecc.curveName=function(t){var e;for(e in o.ecc.curves)if(o.ecc.curves.hasOwnProperty(e)&&o.ecc.curves[e]===t)return e;throw new o.exception.invalid("no such curve")};o.ecc.deserialize=function(t){var e=["elGamal","ecdsa"];if(!t||!t.curve||!o.ecc.curves[t.curve])throw new o.exception.invalid("invalid serialization");if(e.indexOf(t.type)===-1)throw new o.exception.invalid("invalid type");var i=o.ecc.curves[t.curve];if(t.secretKey){if(!t.exponent)throw new o.exception.invalid("invalid exponent");var r=new o.bn(t.exponent);return new o.ecc[t.type].secretKey(i,r)}else{if(!t.point)throw new o.exception.invalid("invalid point");var n=i.fromBits(o.codec.hex.toBits(t.point));return new o.ecc[t.type].publicKey(i,n)}};o.ecc.basicKey={publicKey:function(t,e){this._curve=t,this._curveBitLength=t.r.bitLength(),e instanceof Array?this._point=t.fromBits(e):this._point=e,this.serialize=function(){var i=o.ecc.curveName(t);return{type:this.getType(),secretKey:!1,point:o.codec.hex.fromBits(this._point.toBits()),curve:i}},this.get=function(){var i=this._point.toBits(),r=o.bitArray.bitLength(i),n=o.bitArray.bitSlice(i,0,r/2),s=o.bitArray.bitSlice(i,r/2);return{x:n,y:s}}},secretKey:function(t,e){this._curve=t,this._curveBitLength=t.r.bitLength(),this._exponent=e,this.serialize=function(){var i=this.get(),r=o.ecc.curveName(t);return{type:this.getType(),secretKey:!0,exponent:o.codec.hex.fromBits(i),curve:r}},this.get=function(){return this._exponent.toBits()}}};o.ecc.basicKey.generateKeys=function(t){return function(i,r,n){if(i=i||256,typeof i=="number"&&(i=o.ecc.curves["c"+i],i===void 0))throw new o.exception.invalid("no such curve");n=n||o.bn.random(i.r,r);var s=i.G.mult(n);return{pub:new o.ecc[t].publicKey(i,s),sec:new o.ecc[t].secretKey(i,n)}}};o.ecc.elGamal={generateKeys:o.ecc.basicKey.generateKeys("elGamal"),publicKey:function(t,e){o.ecc.basicKey.publicKey.apply(this,arguments)},secretKey:function(t,e){o.ecc.basicKey.secretKey.apply(this,arguments)}};o.ecc.elGamal.publicKey.prototype={kem:function(t){var e=o.bn.random(this._curve.r,t),i=this._curve.G.mult(e).toBits(),r=o.hash.sha256.hash(this._point.mult(e).toBits());return{key:r,tag:i}},getType:function(){return"elGamal"}};o.ecc.elGamal.secretKey.prototype={unkem:function(t){return o.hash.sha256.hash(this._curve.fromBits(t).mult(this._exponent).toBits())},dh:function(t){return o.hash.sha256.hash(t._point.mult(this._exponent).toBits())},dhJavaEc:function(t){return t._point.mult(this._exponent).x.toBits()},getType:function(){return"elGamal"}};o.ecc.ecdsa={generateKeys:o.ecc.basicKey.generateKeys("ecdsa")};o.ecc.ecdsa.publicKey=function(t,e){o.ecc.basicKey.publicKey.apply(this,arguments)};o.ecc.ecdsa.publicKey.prototype={verify:function(t,e,i){o.bitArray.bitLength(t)>this._curveBitLength&&(t=o.bitArray.clamp(t,this._curveBitLength));var r=o.bitArray,n=this._curve.r,s=this._curveBitLength,a=o.bn.fromBits(r.bitSlice(e,0,s)),c=o.bn.fromBits(r.bitSlice(e,s,2*s)),h=i?c:c.inverseMod(n),l=o.bn.fromBits(t).mul(h).mod(n),f=a.mul(h).mod(n),u=this._curve.G.mult2(l,f,this._point).x;if(a.equals(0)||c.equals(0)||a.greaterEquals(n)||c.greaterEquals(n)||!u.equals(a)){if(i===void 0)return this.verify(t,e,!0);throw new o.exception.corrupt("signature didn't check out")}return!0},getType:function(){return"ecdsa"}};o.ecc.ecdsa.secretKey=function(t,e){o.ecc.basicKey.secretKey.apply(this,arguments)};o.ecc.ecdsa.secretKey.prototype={sign:function(t,e,i,r){o.bitArray.bitLength(t)>this._curveBitLength&&(t=o.bitArray.clamp(t,this._curveBitLength));var n=this._curve.r,s=n.bitLength(),a=r||o.bn.random(n.sub(1),e).add(1),c=this._curve.G.mult(a).x.mod(n),h=o.bn.fromBits(t).add(c.mul(this._exponent)),l=i?h.inverseMod(n).mul(a).mod(n):h.mul(a.inverseMod(n)).mod(n);return o.bitArray.concat(c.toBits(s),l.toBits(s))},getType:function(){return"ecdsa"}};typeof ArrayBuffer>"u"&&(function(t){t.ArrayBuffer=function(){},t.DataView=function(){}})(void 0);o.codec.arrayBuffer={fromBits:function(t,e,i){var r,n,s,a,c;if(e=e??!0,i=i||8,t.length===0)return new ArrayBuffer(0);if(s=o.bitArray.bitLength(t)/8,o.bitArray.bitLength(t)%8!==0)throw new o.exception.invalid("Invalid bit size, must be divisble by 8 to fit in an arraybuffer correctly");for(e&&s%i!==0&&(s+=i-s%i),a=new DataView(new ArrayBuffer(t.length*4)),n=0;n<t.length;n++)a.setUint32(n*4,t[n]<<32);if(r=new DataView(new ArrayBuffer(s)),r.byteLength===a.byteLength)return a.buffer;for(c=a.byteLength<r.byteLength?a.byteLength:r.byteLength,n=0;n<c;n++)r.setUint8(n,a.getUint8(n));return r.buffer},toBits:function(t){var e,i=[],r,n,s;if(t.byteLength===0)return[];n=new DataView(t),r=n.byteLength-n.byteLength%4;for(var e=0;e<r;e+=4)i.push(n.getUint32(e));if(n.byteLength%4!=0){s=new DataView(new ArrayBuffer(4));for(var e=0,a=n.byteLength%4;e<a;e++)s.setUint8(e+4-a,n.getUint8(r+e));i.push(o.bitArray.partial(n.byteLength%4*8,s.getUint32(0)))}return i},hexDumpBuffer:function(t){for(var e=new DataView(t),i="",r=function(s,a){return s=s+"",s.length>=a?s:new Array(a-s.length+1).join("0")+s},n=0;n<e.byteLength;n+=2)n%16==0&&(i+=`
`+n.toString(16)+"	"),i+=r(e.getUint16(n).toString(16),4)+" ";typeof console===void 0&&(console=console||{log:function(){}}),console.log(i.toUpperCase())}};typeof $<"u"&&$.exports&&($.exports=o);typeof define=="function"&&define([],function(){return o});class fe extends Uint8Array{constructor(){super(...arguments),this._serializedEltBrand=""}}class ze extends Uint8Array{constructor(){super(...arguments),this._serializedScalarBrand=""}}async function Ae(t,e,i,r){const{outLenBytes:n,blockLenBytes:s}=Ne(t),a=Math.ceil(r/n);if(a>255)throw new Error("too big");let c=i;if(i.length>255){const b=new TextEncoder,p=U([b.encode("H2C-OVERSIZE-DST-"),i]);c=new Uint8Array(await crypto.subtle.digest(t,p))}c=U([c,new Uint8Array([c.length])]);const h=new Uint8Array(s),l=new Uint8Array(2);l[0]=r>>8&255,l[1]=r&255;const f=U([h,e,l,new Uint8Array([0]),c]),u=new Uint8Array(await crypto.subtle.digest(t,f)),d=U([u,new Uint8Array([1]),c]);let m=new Uint8Array(await crypto.subtle.digest(t,d)),y=U([m]);for(let b=2;b<=a;b++){const p=U([Ke(m,u),new Uint8Array([b]),c]);m=new Uint8Array(await crypto.subtle.digest(t,p)),y=U([y,m])}return y.slice(0,r)}var K;(function(t){t.P256="P-256",t.P384="P-384",t.P521="P-521"})(K||(K={}));class _e{constructor(e){switch(e){case K.P256:this.curve=o.ecc.curves.c256,this.size=32,this.hashParams={hash:"SHA-256",L:48,Z:-10,c2:"0x78bc71a02d89ec07214623f6d0f955072c7cc05604a5a6e23ffbf67115fa5301"};break;case K.P384:this.curve=o.ecc.curves.c384,this.size=48,this.hashParams={hash:"SHA-384",L:72,Z:-12,c2:"0x19877cc1041b7555743c0ae2e3a3e61fb2aaa2e0e87ea557a563d8b598a0940d0a697a9e0b9e92cfaa314f583c9d066"};break;case K.P521:this.curve=o.ecc.curves.c521,this.size=66,this.hashParams={hash:"SHA-512",L:98,Z:-4,c2:"0x8"};break;default:throw new Error(`group not implemented: ${e}`)}this.id=e}static getID(e){switch(e){case"P-256":return K.P256;case"P-384":return K.P384;case"P-521":return K.P521;default:throw new Error(`group not implemented: ${e}`)}}identity(){return new o.ecc.point(this.curve)}generator(){return this.curve.G}order(){return this.curve.r}serUnComp(e){const i=o.codec.arrayBuffer.fromBits(e.toBits(),!1),r=new Uint8Array(i);if(r.length!==2*this.size)throw new Error("error serializing element");const n=new fe(1+2*this.size);return n[0]=4,n.set(r,1),n}serComp(e){const i=o.codec.arrayBuffer.fromBits(e.x.toBits(),!1),r=new Uint8Array(i),n=new fe(1+this.size);return n[0]=2|e.y.limbs[0]&1,n.set(r,1+this.size-r.length),n}serialize(e,i=!0){return e.isIdentity?new fe(1):(e.x.fullReduce(),e.y.fullReduce(),i?this.serComp(e):this.serUnComp(e))}deserComp(e){const i=Array.from(e.slice(1)),r=o.codec.bytes.toBits(i),n=new this.curve.field(o.bn.fromBits(r)),s=this.curve.field.modulus,a=s.add(new o.bn(1)).halveM().halveM();let c=n.square().add(this.curve.a).mul(n).add(this.curve.b).power(a);c.fullReduce(),(e[0]&1)!==(c.limbs[0]&1)&&(c=s.sub(c).mod(s));const h=new o.ecc.point(this.curve,new o.bn(n),new o.bn(c));if(!h.isValid())throw new Error("point not in curve");return h}deserUnComp(e){const i=Array.from(e.slice(1)),r=o.codec.bytes.toBits(i),n=this.curve.fromBits(r);return n.x.fullReduce(),n.y.fullReduce(),n}deserialize(e){const i=e.length;switch(!0){case(i===1&&e[0]===0):return this.identity();case(i===1+this.size&&(e[0]===2||e[0]===3)):return this.deserComp(e);case(i===1+2*this.size&&e[0]===4):return this.deserUnComp(e);default:throw new Error("error deserializing element")}}serializeScalar(e){const i=e.mod(this.curve.r);i.normalize();const r=o.codec.arrayBuffer.fromBits(i.toBits(),!1),n=new Uint8Array(r),s=new ze(this.size);return s.set(n,this.size-n.length),s}deserializeScalar(e){const i=Array.from(e),r=o.bn.fromBits(o.codec.bytes.toBits(i));if(r.normalize(),r.greaterEquals(this.curve.r))throw new Error("error deserializing scalar");return r}addScalar(e,i){const r=e.add(i);return r.mod(this.curve.r),r.normalize(),r}invScalar(e){return e.inverseMod(this.curve.r)}static mul(e,i){return i.mult(e)}mulBase(e){return this.curve.G.mult(e)}equal(e,i){return this.curve!==e.curve||this.curve!==i.curve?!1:e.isIdentity&&i.isIdentity?!0:e.x.equals(i.x)&&e.y.equals(i.y)}randomScalar(){const e=new Uint8Array(this.hashParams.L);return crypto.getRandomValues(e),this.hashToScalar(e,new Uint8Array)}async hashToScalar(e,i){const{hash:r,L:n}=this.hashParams,s=await Ae(r,e,i,n),a=Array.from(s),c=o.codec.bytes.toBits(a);return o.bn.fromBits(c).mod(this.curve.r)}async hashToGroup(e,i){const r=await this.hashToField(e,i,2),n=this.sswu(r[0]),s=this.sswu(r[1]);return n.toJac().add(s).toAffine()}async hashToField(e,i,r){const{hash:n,L:s}=this.hashParams,a=await Ae(n,e,i,r*s),c=new Array(r);for(let h=0;h<r;h++){const l=h*s,f=Array.from(a.slice(l,l+s)),u=o.codec.bytes.toBits(f);c[h]=new this.curve.field(o.bn.fromBits(u))}return c}sswu(e){const i=this.curve.a,r=this.curve.b,n=this.curve.field.modulus,s=new this.curve.field(this.hashParams.Z),a=new o.bn(this.hashParams.c2),c=n.sub(new o.bn(3)).halveM().halveM(),h=new this.curve.field(0),l=new this.curve.field(1);function f(x){return x.fullReduce(),x.limbs[0]&1}function u(x,A,I){return I?A:x}let d=e.square();const m=s.mul(d);let y=m.square(),b=y.add(m),p=b.add(l);p=p.mul(r);let w=n.sub(i);b=b.mul(w);const k=b.equals(h);w=i.mul(s),b=u(b,w,k),y=b.square();const z=y.mul(b);y=y.mul(i);let S=p.square();S=S.add(y),S=S.mul(p),y=z.mul(r),S=S.add(y),w=z.square(),y=S.mul(z),w=w.mul(y);let E=w.power(c);E=E.mul(y);const H=m.mul(p);let L=E.mul(a);L=L.mul(d),L=L.mul(e),y=E.square(),y=y.mul(z);const F=y.equals(S),D=u(H,p,F);let g=u(L,E,F);const R=f(e)===f(g);d=n.sub(g),g=u(d,g,R);let v=b.inverseMod(n);v=D.mul(v);const C=new o.ecc.point(this.curve,new o.bn(v),new o.bn(g));if(!C.isValid())throw new Error("point not in curve");return C}}_e.paranoia=6;var X;(function(t){t[t.OPRF_P256_SHA256=3]="OPRF_P256_SHA256",t[t.OPRF_P384_SHA384=4]="OPRF_P384_SHA384",t[t.OPRF_P521_SHA512=5]="OPRF_P521_SHA512"})(X||(X={}));class M{constructor(e){this.params=M.params(e)}static validateID(e){switch(e){case X.OPRF_P256_SHA256:case X.OPRF_P384_SHA384:case X.OPRF_P521_SHA512:return!0;default:throw new Error(`not supported ID: ${e}`)}}static params(e){M.validateID(e);let i=K.P256,r="SHA-256";switch(e){case X.OPRF_P256_SHA256:break;case X.OPRF_P384_SHA384:i=K.P384,r="SHA-384";break;case X.OPRF_P521_SHA512:i=K.P521,r="SHA-512";break;default:throw new Error(`not supported ID: ${e}`)}const n=new _e(i);return{id:e,gg:n,hash:r,blindedSize:1+n.size,evaluationSize:1+n.size,blindSize:n.size}}static getContextString(e){return M.validateID(e),U([new TextEncoder().encode(M.version),new Uint8Array([M.mode,0,e])])}static getHashToGroupDST(e){return U([new TextEncoder().encode("HashToGroup-"),M.getContextString(e)])}static getHashToScalarDST(e){return U([new TextEncoder().encode("HashToScalar-"),M.getContextString(e)])}static getEvalContext(e,i){return U([new TextEncoder().encode("Context-"),M.getContextString(e),ce(i.length),i])}async coreFinalize(e,i,r){const n=U([new TextEncoder().encode("Finalize-"),M.getContextString(this.params.id)]),s=U([ce(e.length),e,ce(i.length),i,ce(r.length),r,ce(n.length),n]);return new Uint8Array(await crypto.subtle.digest(this.params.hash,s))}}M.mode=0;M.version="VOPRF08-";function B(t){let e=0;for(let r=0;r<t.length;r++)e+=t[r].length;const i=new Uint8Array(new ArrayBuffer(e));for(let r=0,n=0;r<t.length;r++)i.set(t[r],n),n+=t[r].length;return i}function Be(t,e){if(!(e>0&&e<=32))throw new Error("only supports 32-bit encoding");const i=1<<e;if(!(t>=0&&t<i))throw new Error(`number out of range [0,2^${e}-1]`);const r=Math.ceil(e/8),n=new Uint8Array(r);for(let s=0;s<r;s++)n[r-1-s]=t>>8*s&255;return n}function Le(t,e){return B([Be(t.length,e),t])}function ke(t){return Le(t,8)}function he(t){return Le(t,16)}function O(t,e,i="array"){if(t.length<e)throw new Error(`${i} has wrong length`);return t.slice(0,e)}function Oe(t,e){if(t.length!==e.length||t.length===0)throw new Error("arrays of different length");const i=t.length,r=new Uint8Array(i);for(let n=0;n<i;n++)r[n]=t[n]^e[n];return r}const je=new TextEncoder;function P(t){return Array.from(je.encode(t))}const q={AuthKey:P("AuthKey"),ClientMAC:P("ClientMAC"),CredentialResponsePad:P("CredentialResponsePad"),ExportKey:P("ExportKey"),HandshakeSecret:P("HandshakeSecret"),MaskingKey:P("MaskingKey"),OPAQUE:P("OPAQUE-"),OPAQUE_DeriveAuthKeyPair:P("OPAQUE-DeriveAuthKeyPair"),OPAQUE_DeriveKeyPair:P("OPAQUE-DeriveKeyPair"),OprfKey:P("OprfKey"),PrivateKey:P("PrivateKey"),RFC:P("RFCXXXX"),ServerMAC:P("ServerMAC"),SessionKey:P("SessionKey")};function Ge(t,e,i,r,n){const s=B([Be(n,16),ke(B([Uint8Array.from(q.OPAQUE),i])),ke(r)]);return t.kdf.expand(e,s,n)}function ue(t,e,i,r){return Ge(t,e,i,r,t.kdf.Nx)}function Ve(t,e,i,r,n){return B([Uint8Array.from(q.RFC),he(n),he(r),Uint8Array.from(t.serialize()),he(i),Uint8Array.from(e.response.serialize()),e.auth_response.server_nonce,e.auth_response.server_keyshare])}function We(t,e){const{gg:i}=M.params(t.oprf.id),r=new Array(3);for(let n=0;n<3;n++){const{sk:s,pk:a}=e[n],c=i.deserialize(new fe(a)),h=i.deserializeScalar(new ze(s)),l=_e.mul(h,c);r[n]=i.serialize(l)}return B(r)}async function $e(t,e,i){const r=new Uint8Array(t.hash.Nh),n=await t.kdf.extract(r,e),s=await t.hash.sum(i),a=await ue(t,n,Uint8Array.from(q.HandshakeSecret),s),c=await ue(t,n,Uint8Array.from(q.SessionKey),s),h=new Uint8Array,l=await ue(t,a,Uint8Array.from(q.ServerMAC),h),f=await ue(t,a,Uint8Array.from(q.ClientMAC),h);return{Km2:l,Km3:f,session_key:c}}/*! noble-hashes - MIT License (c) 2021 Paul Miller (paulmillr.com) */const be=t=>new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4)),de=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),G=(t,e)=>t<<32-e|t>>>e,Qe=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Qe)throw new Error("Non little-endian hardware is not supported");Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));(()=>{const t=typeof $<"u"&&typeof $.require=="function"&&$.require.bind($);try{if(t){const{setImmediate:e}=t("timers");return()=>new Promise(i=>e(i))}}catch{}return()=>new Promise(e=>setTimeout(e,0))})();function le(t){if(typeof t=="string"&&(t=new TextEncoder().encode(t)),!(t instanceof Uint8Array))throw new TypeError(`Expected input type is Uint8Array (got ${typeof t})`);return t}function N(t){if(!Number.isSafeInteger(t))throw new Error(`Wrong integer: ${t}`)}function Fe(t){if(typeof t!="function"||typeof t.init!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");N(t.outputLen),N(t.blockLen)}let we=class{clone(){return this._cloneInto()}};const Je=t=>Object.prototype.toString.call(t)==="[object Object]"&&t.constructor===Object;function Re(t,e){if(e!==void 0&&(typeof e!="object"||!Je(e)))throw new TypeError("Options should be object or undefined");return Object.assign(t,e)}function Ye(t){const e=r=>t().update(le(r)).digest(),i=t();return e.outputLen=i.outputLen,e.blockLen=i.blockLen,e.create=()=>t(),e.init=e.create,e}function Xe(t,e,i,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,i,r);const n=BigInt(32),s=BigInt(4294967295),a=Number(i>>n&s),c=Number(i&s),h=r?4:0,l=r?0:4;t.setUint32(e+h,a,r),t.setUint32(e+l,c,r)}class Ze extends we{constructor(e,i,r,n){super(),this.blockLen=e,this.outputLen=i,this.padOffset=r,this.isLE=n,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=de(this.buffer)}update(e){if(this.destroyed)throw new Error("instance is destroyed");const{view:i,buffer:r,blockLen:n,finished:s}=this;if(s)throw new Error("digest() was already called");e=le(e);const a=e.length;for(let c=0;c<a;){const h=Math.min(n-this.pos,a-c);if(h===n){const l=de(e);for(;n<=a-c;c+=n)this.process(l,c);continue}r.set(e.subarray(c,c+h),this.pos),this.pos+=h,c+=h,this.pos===n&&(this.process(i,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){if(this.destroyed)throw new Error("instance is destroyed");if(!(e instanceof Uint8Array)||e.length<this.outputLen)throw new Error("_Sha2: Invalid output buffer");if(this.finished)throw new Error("digest() was already called");this.finished=!0;const{buffer:i,view:r,blockLen:n,isLE:s}=this;let{pos:a}=this;i[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>n-a&&(this.process(r,0),a=0);for(let h=a;h<n;h++)i[h]=0;Xe(r,n-8,BigInt(this.length*8),s),this.process(r,0);const c=de(e);this.get().forEach((h,l)=>c.setUint32(4*l,h,s))}digest(){const{buffer:e,outputLen:i}=this;this.digestInto(e);const r=e.slice(0,i);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:i,buffer:r,length:n,finished:s,destroyed:a,pos:c}=this;return e.length=n,e.pos=c,e.finished=s,e.destroyed=a,n%i&&e.buffer.set(r),e}}const et=(t,e,i)=>t&e^~t&i,tt=(t,e,i)=>t&e^t&i^e&i,it=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),J=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Y=new Uint32Array(64);class rt extends Ze{constructor(){super(64,32,8,!1),this.A=J[0]|0,this.B=J[1]|0,this.C=J[2]|0,this.D=J[3]|0,this.E=J[4]|0,this.F=J[5]|0,this.G=J[6]|0,this.H=J[7]|0}get(){const{A:e,B:i,C:r,D:n,E:s,F:a,G:c,H:h}=this;return[e,i,r,n,s,a,c,h]}set(e,i,r,n,s,a,c,h){this.A=e|0,this.B=i|0,this.C=r|0,this.D=n|0,this.E=s|0,this.F=a|0,this.G=c|0,this.H=h|0}process(e,i){for(let u=0;u<16;u++,i+=4)Y[u]=e.getUint32(i,!1);for(let u=16;u<64;u++){const d=Y[u-15],m=Y[u-2],y=G(d,7)^G(d,18)^d>>>3,b=G(m,17)^G(m,19)^m>>>10;Y[u]=b+Y[u-7]+y+Y[u-16]|0}let{A:r,B:n,C:s,D:a,E:c,F:h,G:l,H:f}=this;for(let u=0;u<64;u++){const d=G(c,6)^G(c,11)^G(c,25),m=f+d+et(c,h,l)+it[u]+Y[u]|0,b=(G(r,2)^G(r,13)^G(r,22))+tt(r,n,s)|0;f=l,l=h,h=c,c=a+m|0,a=s,s=n,n=r,r=m+b|0}r=r+this.A|0,n=n+this.B|0,s=s+this.C|0,a=a+this.D|0,c=c+this.E|0,h=h+this.F|0,l=l+this.G|0,f=f+this.H|0,this.set(r,n,s,a,c,h,l,f)}roundClean(){Y.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const Ce=Ye(()=>new rt);class Pe extends we{constructor(e,i){super(),this.finished=!1,this.destroyed=!1,Fe(e);const r=le(i);if(this.iHash=e.create(),!(this.iHash instanceof we))throw new TypeError("Expected instance of class which extends utils.Hash");const n=this.blockLen=this.iHash.blockLen;this.outputLen=this.iHash.outputLen;const s=new Uint8Array(n);s.set(r.length>this.iHash.blockLen?e.create().update(r).digest():r);for(let a=0;a<s.length;a++)s[a]^=54;this.iHash.update(s),this.oHash=e.create();for(let a=0;a<s.length;a++)s[a]^=106;this.oHash.update(s),s.fill(0)}update(e){if(this.destroyed)throw new Error("instance is destroyed");return this.iHash.update(e),this}digestInto(e){if(this.destroyed)throw new Error("instance is destroyed");if(!(e instanceof Uint8Array)||e.length!==this.outputLen)throw new Error("HMAC: Invalid output buffer");if(this.finished)throw new Error("digest() was already called");this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:i,iHash:r,finished:n,destroyed:s,blockLen:a,outputLen:c}=this;return e=e,e.finished=n,e.destroyed=s,e.blockLen=a,e.outputLen=c,e.oHash=i._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const ye=(t,e,i)=>new Pe(t,e).update(i).digest();ye.create=(t,e)=>new Pe(t,e);ye.init=ye.create;function nt(t,e,i,r){Fe(t);const n=Re({dkLen:32,asyncTick:10},r),{c:s,dkLen:a,asyncTick:c}=n;if(N(s),N(a),N(c),s<1)throw new Error("PBKDF2: iterations (c) should be >= 1");const h=le(e),l=le(i),f=new Uint8Array(a),u=ye.init(t,h),d=u._cloneInto().update(l);return{c:s,dkLen:a,asyncTick:c,DK:f,PRF:u,PRFSalt:d}}function st(t,e,i,r,n){return t.destroy(),e.destroy(),r&&r.destroy(),n.fill(0),i}function Me(t,e,i,r){const{c:n,dkLen:s,DK:a,PRF:c,PRFSalt:h}=nt(t,e,i,r);let l;const f=new Uint8Array(4),u=de(f),d=new Uint8Array(c.outputLen);for(let m=1,y=0;y<s;m++,y+=c.outputLen){const b=a.subarray(y,y+c.outputLen);u.setInt32(0,m,!1),(l=h._cloneInto(l)).update(f).digestInto(d),b.set(d.subarray(0,b.length));for(let p=1;p<n;p++){c._cloneInto(l).update(d).digestInto(d);for(let w=0;w<b.length;w++)b[w]^=d[w]}}return st(c,h,a,l,d)}const _=(t,e)=>t<<e|t>>>32-e;function Ee(t,e,i,r,n,s){let a=t[e++]^i[r++],c=t[e++]^i[r++],h=t[e++]^i[r++],l=t[e++]^i[r++],f=t[e++]^i[r++],u=t[e++]^i[r++],d=t[e++]^i[r++],m=t[e++]^i[r++],y=t[e++]^i[r++],b=t[e++]^i[r++],p=t[e++]^i[r++],w=t[e++]^i[r++],k=t[e++]^i[r++],z=t[e++]^i[r++],S=t[e++]^i[r++],E=t[e++]^i[r++],H=a,L=c,F=h,D=l,g=f,R=u,v=d,C=m,x=y,A=b,I=p,Z=w,ee=k,te=z,ie=S,re=E;for(let xe=0;xe<8;xe+=2)g^=_(H+ee|0,7),x^=_(g+H|0,9),ee^=_(x+g|0,13),H^=_(ee+x|0,18),A^=_(R+L|0,7),te^=_(A+R|0,9),L^=_(te+A|0,13),R^=_(L+te|0,18),ie^=_(I+v|0,7),F^=_(ie+I|0,9),v^=_(F+ie|0,13),I^=_(v+F|0,18),D^=_(re+Z|0,7),C^=_(D+re|0,9),Z^=_(C+D|0,13),re^=_(Z+C|0,18),L^=_(H+D|0,7),F^=_(L+H|0,9),D^=_(F+L|0,13),H^=_(D+F|0,18),v^=_(R+g|0,7),C^=_(v+R|0,9),g^=_(C+v|0,13),R^=_(g+C|0,18),Z^=_(I+A|0,7),x^=_(Z+I|0,9),A^=_(x+Z|0,13),I^=_(A+x|0,18),ee^=_(re+ie|0,7),te^=_(ee+re|0,9),ie^=_(te+ee|0,13),re^=_(ie+te|0,18);n[s++]=a+H|0,n[s++]=c+L|0,n[s++]=h+F|0,n[s++]=l+D|0,n[s++]=f+g|0,n[s++]=u+R|0,n[s++]=d+v|0,n[s++]=m+C|0,n[s++]=y+x|0,n[s++]=b+A|0,n[s++]=p+I|0,n[s++]=w+Z|0,n[s++]=k+ee|0,n[s++]=z+te|0,n[s++]=S+ie|0,n[s++]=E+re|0}function pe(t,e,i,r,n){let s=r+0,a=r+16*n;for(let c=0;c<16;c++)i[a+c]=t[e+(2*n-1)*16+c];for(let c=0;c<n;c++,s+=16,e+=16)Ee(i,a,t,e,i,s),c>0&&(a+=16),Ee(i,s,t,e+=16,i,a)}function ot(t,e,i){const r=Re({dkLen:32,asyncTick:10,maxmem:1073742848},i),{N:n,r:s,p:a,dkLen:c,asyncTick:h,maxmem:l,onProgress:f}=r;if(N(n),N(s),N(a),N(c),N(h),N(l),f!==void 0&&typeof f!="function")throw new Error("progressCb should be function");const u=128*s,d=u/4;if(n<=1||(n&n-1)!==0||n>=2**(u/8)||n>2**32)throw new Error("Scrypt: N must be larger than 1, a power of 2, less than 2^(128 * r / 8) and less than 2^32");if(a<0||a>(2**32-1)*32/u)throw new Error("Scrypt: p must be a positive integer less than or equal to ((2^32 - 1) * 32) / (128 * r)");if(c<0||c>(2**32-1)*32)throw new Error("Scrypt: dkLen should be positive integer less than or equal to (2^32 - 1) * 32");const m=u*(n+a);if(m>l)throw new Error(`Scrypt: parameters too large, ${m} (128 * r * (N + p)) > ${l} (maxmem)`);const y=Me(Ce,t,e,{c:1,dkLen:u*a}),b=be(y),p=be(new Uint8Array(u*n)),w=be(new Uint8Array(u));let k=()=>{};if(f){const z=2*n*a,S=Math.max(Math.floor(z/1e4),1);let E=0;k=()=>{E++,f&&(!(E%S)||E===z)&&f(E/z)}}return{N:n,r:s,p:a,dkLen:c,blockSize32:d,V:p,B32:b,B:y,tmp:w,blockMixCb:k,asyncTick:h}}function at(t,e,i,r,n){const s=Me(Ce,t,i,{c:1,dkLen:e});return i.fill(0),r.fill(0),n.fill(0),s}function ct(t,e,i){const{N:r,r:n,p:s,dkLen:a,blockSize32:c,V:h,B32:l,B:f,tmp:u,blockMixCb:d}=ot(t,e,i);for(let m=0;m<s;m++){const y=c*m;for(let b=0;b<c;b++)h[b]=l[y+b];for(let b=0,p=0;b<r-1;b++)pe(h,p,h,p+=c,n),d();pe(h,(r-1)*c,l,y,n),d();for(let b=0;b<r;b++){const p=l[y+c-16]%r;for(let w=0;w<c;w++)u[w]=l[y+w]^h[p*c+w];pe(u,0,l,y,n),d()}}return at(t,a,f,h,u)}class ne{constructor(e){switch(this.name=e,e){case ne.ID.SHA1:this.Nh=20;break;case ne.ID.SHA256:this.Nh=32;break;case ne.ID.SHA384:this.Nh=48;break;case ne.ID.SHA512:this.Nh=64;break;default:throw new Error(`invalid hash name: ${e}`)}}async sum(e){return new Uint8Array(await crypto.subtle.digest(this.name,e))}}(function(t){t.ID={SHA1:"SHA-1",SHA256:"SHA-256",SHA384:"SHA-384",SHA512:"SHA-512"}})(ne||(ne={}));const ge={name:"scrypt",harden:t=>ct(t,new Uint8Array,{N:32768,r:8,p:1})};var Se;(function(t){t[t.OPAQUE_P256=3]="OPAQUE_P256",t[t.OPAQUE_P384=4]="OPAQUE_P384",t[t.OPAQUE_P521=5]="OPAQUE_P521"})(Se||(Se={}));class T{static check_string(e){if(typeof e=="string")return!0;throw new Error("string expected")}static check_uint8array(e){if(e instanceof Uint8Array)return!0;throw new Error("Uint8Array expected")}static check_uint8arrays(e){return e.every(this.check_uint8array)}static check_bytes_array(e){if(!Array.isArray(e)||!e.every(i=>Number.isInteger(i)&&i>=0&&i<=255))throw new Error("Array of byte-sized integers expected");return!0}static check_bytes_arrays(e){return e.every(this.check_bytes_array)}static sizeSerialized(e){throw new Error("child class must implement")}static checked_bytes_to_uint8array(e,i){this.check_bytes_array(i);const r=Uint8Array.from(i);return this.checked_object(e,r),r}static checked_object(e,i){O(i,this.sizeSerialized(e),this.name)}}class W extends T{constructor(e,i,r){super(),this.nonce=O(i,e.constants.Nn),this.auth_tag=O(r,e.mac.Nm)}serialize(){return Array.from(B([this.nonce,this.auth_tag]))}static sizeSerialized(e){return e.constants.Nn+e.mac.Nm}static deserialize(e,i){const r=this.checked_bytes_to_uint8array(e,i);let n=0,s=e.constants.Nn;const a=r.slice(n,s);n=s,s+=e.mac.Nm;const c=r.slice(n,s);return new W(e,a,c)}}class ve extends T{constructor(e,i){T.check_uint8array(i),super(),this.data=O(i,e.oprf.Noe)}serialize(){return Array.from(this.data)}static sizeSerialized(e){return e.oprf.Noe}static deserialize(e,i){const r=this.checked_bytes_to_uint8array(e,i),n=0,s=e.oprf.Noe,a=r.slice(n,s);return new ve(e,a)}}class me extends T{constructor(e,i,r,n){T.check_uint8arrays([i,r]),super(),this.client_public_key=O(i,e.ake.Npk),this.masking_key=O(r,e.hash.Nh),this.envelope=n}serialize(){return Array.from(B([this.client_public_key,this.masking_key,Uint8Array.from(this.envelope.serialize())]))}static sizeSerialized(e){return e.ake.Npk+e.hash.Nh+W.sizeSerialized(e)}static deserialize(e,i){const r=this.checked_bytes_to_uint8array(e,i);let n=0,s=e.ake.Npk;const a=r.slice(n,s);n=s,s+=e.hash.Nh;const c=r.slice(n,s);n=s,s+=W.sizeSerialized(e);const h=r.slice(n,s),l=W.deserialize(e,Array.from(h));return new me(e,a,c,l)}static async createFake(e){const i=e.prng.random(e.constants.Nseed),{public_key:r}=await e.ake.deriveAuthKeyPair(new Uint8Array(i)),n=new Uint8Array(e.prng.random(e.hash.Nh)),s=W.deserialize(e,new Array(W.sizeSerialized(e)).fill(0));return new me(e,r,n,s)}}class se extends T{constructor(e,i){T.check_uint8array(i),super(),this.data=O(i,e.oprf.Noe)}serialize(){return Array.from(this.data)}static sizeSerialized(e){return e.oprf.Noe}static deserialize(e,i){const r=this.checked_bytes_to_uint8array(e,i),n=0,s=e.oprf.Noe,a=r.slice(n,s);return new se(e,a)}}class oe extends T{constructor(e,i,r){T.check_uint8arrays([i,r]),super(),this.client_nonce=O(i,e.constants.Nn),this.client_keyshare=O(r,e.ake.Npk)}serialize(){return Array.from(B([this.client_nonce,this.client_keyshare]))}static sizeSerialized(e){return e.constants.Nn+e.ake.Npk}static deserialize(e,i){const r=this.checked_bytes_to_uint8array(e,i);let n=0,s=e.constants.Nn;const a=r.slice(n,s);n=s,s+=e.ake.Npk;const c=r.slice(n,s);return new oe(e,a,c)}}class ae extends T{constructor(e,i){T.check_uint8array(i),super(),this.client_mac=O(i,e.mac.Nm)}serialize(){return Array.from(this.client_mac.slice())}static sizeSerialized(e){return e.mac.Nm}static deserialize(e,i){const r=this.checked_bytes_to_uint8array(e,i),n=0,s=e.mac.Nm,a=r.slice(n,s);return new ae(e,a)}}let ht=class Ue extends T{constructor(e,i){super(),this.request=e,this.auth_init=i}serialize(){return[...this.request.serialize(),...this.auth_init.serialize()]}static sizeSerialized(e){return se.sizeSerialized(e)+oe.sizeSerialized(e)}static deserialize(e,i){this.checked_bytes_to_uint8array(e,i);let r=0,n=se.sizeSerialized(e);const s=se.deserialize(e,i.slice(r,n));r=n,n+=oe.sizeSerialized(e);const a=oe.deserialize(e,i.slice(r,n));return new Ue(s,a)}},lt=class Te extends T{constructor(e){super(),this.auth_finish=e}serialize(){return this.auth_finish.serialize()}static sizeSerialized(e){return ae.sizeSerialized(e)}static deserialize(e,i){this.checked_bytes_to_uint8array(e,i);const r=0,n=Number(ae.sizeSerialized(e)),s=ae.deserialize(e,i.slice(r,n));return new Te(s)}};class ut{constructor(e){this.config=e}async start(){const e=this.config.prng.random(this.config.constants.Nn),{private_key:i,public_key:r}=await this.config.ake.generateAuthKeyPair();return this.client_secret=new Uint8Array(i),new oe(this.config,new Uint8Array(e),new Uint8Array(r))}async finalize(e,i,r,n,s,a,c){if(typeof this.client_secret>"u")return new Error("ake3dhclient has not started yet");const h=We(this.config,[{sk:this.client_secret,pk:a.auth_response.server_keyshare},{sk:this.client_secret,pk:n},{sk:i,pk:a.auth_response.server_keyshare}]),l=Ve(s,a,r,e,c),{Km2:f,Km3:u,session_key:d}=await $e(this.config,h,l),m=await this.config.hash.sum(l);if(!await(await this.config.mac.with_key(f)).verify(m,a.auth_response.server_mac))return new Error("handshake error");const y=await this.config.hash.sum(B([l,a.auth_response.server_mac])),b=await(await this.config.mac.with_key(u)).sign(y);return{auth_finish:new ae(this.config,b),session_key:d}}}class De{constructor(e,i,r,n,s){this.server_public_key=O(i,e.ake.Npk),this.server_identity=n||i,this.client_identity=s||r}serialize(){return Array.from(B([this.server_public_key,he(this.server_identity),he(this.client_identity)]))}}async function Ie(t,e,i){const r=await t.kdf.expand(e,B([i,Uint8Array.from(q.AuthKey)]),t.hash.Nh),n=await t.kdf.expand(e,B([i,Uint8Array.from(q.ExportKey)]),t.hash.Nh),s=await t.kdf.expand(e,B([i,Uint8Array.from(q.PrivateKey)]),t.constants.Nseed),a=await t.ake.deriveAuthKeyPair(s);return{auth_key:r,export_key:n,client_ake_keypair:a}}async function ft(t,e,i,r,n){const s=new Uint8Array(t.prng.random(t.constants.Nn)),{auth_key:a,export_key:c,client_ake_keypair:h}=await Ie(t,e,s),{public_key:l}=h,f=new De(t,i,l,r,n),u=B([s,Uint8Array.from(f.serialize())]),d=await(await t.mac.with_key(a)).sign(u),m=new W(t,s,d),y=await t.kdf.expand(e,Uint8Array.from(q.MaskingKey),t.hash.Nh);return{envelope:m,client_public_key:l,masking_key:y,export_key:c}}async function dt(t,e,i,r,n,s){const{auth_key:a,export_key:c,client_ake_keypair:h}=await Ie(t,i,e.nonce),{public_key:l}=h,f=new De(t,r,l,n,s),u=B([e.nonce,Uint8Array.from(f.serialize())]);return await(await t.mac.with_key(a)).verify(u,e.auth_tag)?{client_ake_keypair:h,export_key:c}:new Error("EnvelopeRecoveryError")}class yt{constructor(e,i=ge){this.config=e,this.memHard=i}async createRegistrationRequest(e){const{blindedElement:i,blind:r}=await this.config.oprf.blind(e);return{request:new ve(this.config,i),blind:r}}async finalizeRequest(e,i,r,n,s){const a=await this.config.oprf.finalize(e,i,r.evaluation),c=new Uint8Array(this.config.hash.Nh),h=await this.config.kdf.extract(c,B([a,this.memHard.harden(a)])),{envelope:l,client_public_key:f,masking_key:u,export_key:d}=await ft(this.config,h,r.server_public_key,n,s);return{record:new me(this.config,f,u,l),export_key:Array.from(d)}}async createCredentialRequest(e){const{blindedElement:i,blind:r}=await this.config.oprf.blind(e);return{request:new se(this.config,i),blind:r}}async recoverCredentials(e,i,r,n,s){const a=await this.config.oprf.finalize(e,i,r.evaluation),c=new Uint8Array(this.config.hash.Nh),h=await this.config.kdf.extract(c,B([a,this.memHard.harden(a)])),l=await this.config.kdf.expand(h,Uint8Array.from(q.MaskingKey),this.config.hash.Nh),f=W.sizeSerialized(this.config),u=await this.config.kdf.expand(l,B([r.masking_nonce,Uint8Array.from(q.CredentialResponsePad)]),this.config.ake.Npk+f),d=Oe(u,r.masked_response),m=d.slice(0,this.config.ake.Npk),{Npk:y}=this.config.ake,b=d.slice(y,y+f),p=W.deserialize(this.config,Array.from(b)),w=await dt(this.config,p,h,m,n,s);return w instanceof Error?w:{server_public_key:m,...w}}}let qe=class Q{constructor(e,i=ge){this.config=e,this.status=Q.States.NEW,this.opaque_core=new yt(e,i),this.ake=new ut(this.config)}async registerInit(e){if(this.status!==Q.States.NEW)return new Error("client not ready");const i=new TextEncoder().encode(e),{request:r,blind:n}=await this.opaque_core.createRegistrationRequest(i);return this.blind=n,this.password=i,this.status=Q.States.REG_STARTED,r}async registerFinish(e,i,r){if(this.status!==Q.States.REG_STARTED||typeof this.password>"u"||typeof this.blind>"u")return new Error("client not ready");const n=new TextEncoder,s=i?n.encode(i):void 0,a=r?n.encode(r):void 0,c=await this.opaque_core.finalizeRequest(this.password,this.blind,e,s,a);return this.clean(),c}async authInit(e){if(this.status!==Q.States.NEW)return new Error("client not ready");const i=new TextEncoder().encode(e),{request:r,blind:n}=await this.opaque_core.createCredentialRequest(i),s=await this.ake.start(),a=new ht(r,s);return this.blind=n,this.password=i,this.ke1=a,this.status=Q.States.LOG_STARTED,a}async authFinish(e,i,r,n){if(this.status!==Q.States.LOG_STARTED||typeof this.password>"u"||typeof this.blind>"u"||typeof this.ke1>"u")return new Error("client not ready");const s=new TextEncoder,a=i?s.encode(i):void 0,c=r?s.encode(r):void 0,h=n?s.encode(n):new Uint8Array(0),l=await this.opaque_core.recoverCredentials(this.password,this.blind,e.response,a,c);if(l instanceof Error)return l;const{client_ake_keypair:f,server_public_key:u,export_key:d}=l,m=await this.ake.finalize(c||f.public_key,f.private_key,a||u,u,this.ke1,e,h);if(m instanceof Error)return m;const{auth_finish:y,session_key:b}=m,p=new lt(y);return this.clean(),{ke3:p,session_key:Array.from(b),export_key:Array.from(d)}}clean(){this.status=Q.States.NEW,this.password=void 0,this.blind=void 0,this.ke1=void 0}};qe.States={NEW:0,REG_STARTED:1,LOG_STARTED:2};class V extends qe{constructor(e,i=ge){super(e,i),this.status=V.States.NEW}async registerInit(e){if(this.status!==V.States.NEW)return new Error("client not ready");const i=new TextEncoder().encode(e),{request:r,blind:n}=await this.opaque_core.createRegistrationRequest(i);return this.blind=n,this.password=i,this.status=V.States.REG_STARTED,r}async registerFinish(e,i,r){if(this.status!==V.States.REG_STARTED||typeof this.password>"u"||typeof this.blind>"u")return new Error("client not ready");const n=new TextEncoder,s=i?n.encode(i):void 0,a=r?n.encode(r):void 0,c=await this.opaque_core.finalizeRequest(this.password,this.blind,e,s,a);return this.clean(),c}async authInit(e){if(this.status!==V.States.NEW)return new Error("client not ready");const i=new TextEncoder().encode(e),{request:r,blind:n}=await this.opaque_core.createCredentialRequest(i),s=await this.ake.start(),a=new KE1(r,s);return this.blind=n,this.password=i,this.ke1=a,this.status=V.States.LOG_STARTED,a}async authFinish(e,i,r,n){if(this.status!==V.States.LOG_STARTED||typeof this.password>"u"||typeof this.blind>"u"||typeof this.ke1>"u")return new Error("client not ready");const s=new TextEncoder,a=i?s.encode(i):void 0,c=r?s.encode(r):void 0,h=n?s.encode(n):new Uint8Array(0),l=await this.opaque_core.recoverCredentials(this.password,this.blind,e.response,a,c);if(l instanceof Error)return l;const{client_ake_keypair:f,server_public_key:u,export_key:d}=l,m=await this.ake.finalize(c||f.public_key,f.private_key,a||u,u,this.ke1,e,h);if(m instanceof Error)return m;const{auth_finish:y,session_key:b}=m,p=new KE3(y);return this.clean(),{ke3:p,session_key:Array.from(b),export_key:Array.from(d)}}clean(){this.status=V.States.NEW,this.password=void 0,this.blind=void 0,this.ke1=void 0}}document.addEventListener("DOMContentLoaded",async()=>{const t=document.getElementById("register-form");t&&t.addEventListener("submit",async e=>{e.preventDefault();const i="opaque-test-server",r=new FormData(t),n=r.get("username"),s=r.get("password"),a=new V(config),c=await a.registerInit(s),h=await fetch("/api/register/init",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:n,registrationRequest:c})});if(!h.ok)throw new Error("Registration failed");const{registrationResponse:l}=await h.json();await a.registerFinish(l,n,i)})})});export default mt();
